import{j as e,b as m}from"./index-BAjkLHRS.js";import{a as f,W as p,k as w,Y as x,as as C,at as k,q as z,t as c,aG as M,az as A,aA as Y,y as B,l as g,am as L,A as v,V as U,n as W,_ as G}from"./react-spring-web.esm-BXduOQz-.js";import{r as _}from"./index-Djf8kdDz.js";/* empty css              *//* empty css                         */import{u as j}from"./useTranslation-Cclpl_OC.js";import{S as H}from"./Tips-RI6rFAQq.js";import{F as K}from"./index-CMwthcxG.js";import{I as q,a as X}from"./InputSeries-CzwU4lJX.js";import{d as J}from"./index-CnVkoL_H.js";import{F as Q}from"./FormError-B1L9786s.js";function Z({url:a,pathname:n,search:t,isBlob:o,onSuccess:r}){const i=f();return p(()=>w.get(a,o?{responseType:"blob"}:void 0),{onSuccess:r||(({data:l})=>{const{code:u,content:d}=l;if(x.SUCCESS===u){const{rawData:b,filename:h}=d;C.fromBase64(b,h,k)}else i.push({pathname:n,search:t})}),onError(){i.push({pathname:n,search:t})}})}function we({url:a,pathname:n,search:t,mobilePhone:o,isBlob:r,onSuccess:i}){const{t:s}=j(),{isLoading:l,mutate:u}=Z({url:a,pathname:n,search:t,isBlob:r,onSuccess:i}),d=()=>{u()};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(m.SzTypographie,{variant:"H3",size:"L",tag:"h2",weight:"medium",className:"sign-mandate-title",children:s("payment.sign_mandate.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:31,columnNumber:7},this),e.jsxDEV(m.SzTypographie,{className:"sign-mandate-infos",children:s("payment.sign_mandate.infos",{mobilePhone:o})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:41,columnNumber:7},this),e.jsxDEV(m.SzButton,{id:"downloadMandate",icon:"download-bottom",variant:"text",className:"px-0",onClick:d,loader:l,children:s("payment.sign_mandate.btn_download")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:44,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:30,columnNumber:5},this)}function $(){const a=f(),{search:n,pathname:t}=z(),o=new URLSearchParams(n),r=t.includes(c.PAYMENT.ETIP),i=r?M:o.get("payment_mode"),s=o.get("e-facture")==="true",l=o.get("mandat")==="true";return _.useEffect(()=>{i&&![A,Y,M].includes(i)&&a.push(B(c.PAYMENT_INDEX))},[]),{paymentMode:i,eFacture:s,isWithMandat:l,isRouteEtip:r}}function ee({defaultLabelSize:a=!1,...n}){const{name:t}=n,{setFieldValue:o,values:r,errors:i}=g(),s=({target:l})=>{const{checked:u}=l;o(t,u)};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(m.SzCheckbox,{...n,checked:r[t],onChange:s,className:a?"":"small"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:21,columnNumber:7},this),e.jsxDEV(Q,{field:t,customDisplay:i[t]},void 0,!1,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:27,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:20,columnNumber:5},this)}function se(a){const n=f(),{resetForm:t}=g(),o=L(c.SUBSCRIBE_FULL),r=o?v.MOVE_IN.NEW_OTP:v.PAYMENT.GET_PAYMENT_NEW_OPT,i=o?c.MOVE_IN.ERROR_URL:c.PAYMENT.ERROR;return p(()=>w.get(r.concat("?mobilePhone=",encodeURIComponent(a))),{onSuccess:({data:s})=>{(s==null?void 0:s.message)===x.OK?t():n.push(i)}})}function ae(){const a=f();return p(n=>w.post(v.DOCAPOSTE.SEND_OTP,n),{onError(){a.push({pathname:c.PAYMENT.ERROR_ETIP})}})}const ne=W(m.SzIcon)`
  color: var(--gray);
  font-size: 1.125rem;
`,D="input",N="opt-in";function be({onSubmit:a,...n}){const{t}=j(),o={input:"",[N]:!1},r=q({name:D}).shape({[N]:J(t("payment.sign_mandate.form.validation_error"))});return e.jsxDEV(U,{initialValues:o,validationSchema:r,onSubmit:a,enableReinitialize:!0,validateOnChange:!1,validateOnBlur:!0,children:e.jsxDEV(te,{...n},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:58,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:50,columnNumber:5},this)}const te=({errorReset:a,setErrorReset:n,onPrevClick:t,label:o,loadingSubmit:r,mobilePhone:i})=>{const{t:s}=j(),{track:l}=G(),{isRouteEtip:u}=$(),d=f(),{handleSubmit:b,resetForm:h}=g();_.useEffect(()=>{a&&l("PAYMENT_7")},[a]);const S={prefixName:D,length:6,label:s("payment.sign_mandate.form.code_label")},y={label:s("go_back"),arrow:"true",enabled:!0,onClick:t},F={label:o||s("payment.sign_mandate.form.btn_submit"),align:"right",loader:r},{isLoading:T,...V}=se(i),{isLoading:O,...P}=ae(),R={sendBack:"true"},I=()=>{u?P.mutate(R,{onSuccess:({data:E})=>{(E==null?void 0:E.message)===x.OK?(h(),n(!1)):d.push(c.PAYMENT.ERROR_ETIP)}}):V.mutate()};return e.jsxDEV("form",{"data-cy":"mandate-form",onSubmit:b,className:"digit-form pt-3 row w-100 m-0 no-gutters",children:[e.jsxDEV(X,{...S,children:e.jsxDEV(m.SzButton,{onClick:I,className:"cy-btn-reset-index ml-0 ml-sm-4 pl-0",variant:"text",icon:"synchronize-arrow-1",loader:T||O,children:s("payment.sign_mandate.form.btn_retry")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:130,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:129,columnNumber:7},void 0),a&&e.jsxDEV(m.SzTypographie,{tag:"div",variant:"caption",color:"danger",className:"w-100",children:s("payment.sign_mandate.error_otp")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:141,columnNumber:9},void 0),e.jsxDEV(H,{horizontal:!0,className:"my-2 my-lg-4 bg-gray-0"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:151,columnNumber:7},void 0),e.jsxDEV("div",{className:"d-flex align-items-center",children:[e.jsxDEV(ne,{icon:"information-circle",variant:"line"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:153,columnNumber:9},void 0),e.jsxDEV(m.SzTypographie,{tag:"div",variant:"caption",size:"M",className:"ml-2",children:[e.jsxDEV(m.SzTypographie,{className:"mb-0",children:s("payment.sign_mandate.help")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:155,columnNumber:11},void 0),e.jsxDEV("ul",{className:"mb-0 pl-3 ml-2",children:[e.jsxDEV(m.SzTypographie,{tag:"li",children:s("payment.sign_mandate.help_1")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:159,columnNumber:13},void 0),e.jsxDEV(m.SzTypographie,{tag:"li",children:s("payment.sign_mandate.help_2")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:163,columnNumber:13},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:158,columnNumber:11},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:154,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:152,columnNumber:7},void 0),e.jsxDEV("div",{className:"col-12 mt-4 mt-lg-5 mb-3",children:e.jsxDEV(ee,{id:N,name:N,label:s("payment.sign_mandate.form.validation_label")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:170,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:169,columnNumber:7},void 0),e.jsxDEV(K,{previous:y,next:F},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:176,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:124,columnNumber:5},void 0)};function he({url:a,onSuccess:n,onError:t}){return p(o=>w.post(a,o),{onSuccess:n,onError:t})}export{we as D,be as M,he as a,ae as b,$ as u};
