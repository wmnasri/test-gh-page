import{j as e,b as t,a as pe}from"./index-BzhTyqaY.js";import{r as a}from"./index-0X8QCd_i.js";import{R as Q,f as he,F as Ne}from"./main-BbuvrTKi.js";import{u as q}from"./useMutation-DnofRurj.js";import{u as fe}from"./useQuery-DDRZMcvI.js";import{F as G,O as we,S as b}from"./formik.esm-DgjVmEdT.js";import{a as J,u as je}from"./useResponsive-DQBhMvnf.js";import{i as Ee}from"./releve_index-BZ8gkQLR.js";import{M as p}from"./Meter-BDG96XlC.js";import{E as K,S as be}from"./ErrorPc-DZ56a4Ey.js";import{u as Y,g as ve,c as Me}from"./AxiosInstance-BZZbXQ8a.js";import{HelpBody as ye}from"./LandingPage-SUZMokGm.js";/* empty css                      */import{u as Z}from"./useTranslation-BYGhmYBG.js";import"./index-BoI371yk.js";import"./index-4p5aklhB.js";import"./throttle-C5YRRb_b.js";import"./_baseIsEqual-DwR-aJgz.js";import"./iframe-CrganuSH.js";import"../sb-preview/runtime.js";import"./nonIterableRest-CnCppAvF.js";import"./index-R4VhrMC6.js";function ge({reference:c,isShow:v,indexSaisi:r,outOfBoundsWayForModal:M,handleClose:y}){const g=J(),{t:o}=Z(),z=Y(),[I,B]=a.useState(!0),[D]=a.useState(),[x,l]=a.useState(!1),[S,T]=a.useState(null),[C,k]=a.useState(!1),P=o(M===ee?"photoMeter.indexEntryModal.boundSub":"photoMeter.indexEntryModal.boundSup"),V=o("photoMeter.indexEntryModal.fullTextInfOrSup",{infOrSup:P}),u=()=>{l(!0),p.validationMotif().then(n=>{if(n.isError===!0)l(!1),T(n.errorMessage),k(!0);else{const h=ve(Q.PHOTO_COUNTER_PHOTO,{reference:c});z.push(h)}})},O=e.jsxDEV("div",{id:"indexEntryModal",className:"row",children:e.jsxDEV(G,{initialValues:{motif:""},validationSchema:!1,validateOnChange:!1,validateOnBlur:!1,onSubmit:u,children:({handleChange:n,handleSubmit:h})=>{const f=R=>{B(!I),n(R)};return C?e.jsxDEV(K,{message:S,indiceError:1},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:80,columnNumber:20},this):e.jsxDEV("form",{onSubmit:h,children:[e.jsxDEV("div",{"data-cy":"alert",className:"col-12 mb-3",children:e.jsxDEV(t.SzAlert,{variant:"danger",className:"p-2 rounded-1",children:V},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:86,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:85,columnNumber:15},this),e.jsxDEV("div",{"data-cy":"indexEntry",className:"col-12 my-3",children:e.jsxDEV(t.SzBox,{className:"p-3 border border-1 border-gray-100 bg-gray-100 rounded-1",children:e.jsxDEV(t.SzData,{className:"text-center",children:[e.jsxDEV(t.SzData.Text,{children:o("photoMeter.indexEntryModal.yourInput")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:93,columnNumber:21},this),e.jsxDEV(t.SzData.Title,{children:r},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:96,columnNumber:21},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:92,columnNumber:19},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:91,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:90,columnNumber:15},this),e.jsxDEV("div",{className:"col-12 my-3",children:e.jsxDEV(t.SzBox,{className:"p-3 border border-1 border-gray-50",children:e.jsxDEV(t.SzCheckbox,{id:"foyer",name:"motif",label:o("photoMeter.indexEntryModal.confirmReading"),className:"custom-control-vertical",value:"codeMotif1",checked:D,onChange:f},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:102,columnNumber:19},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:101,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:100,columnNumber:15},this),e.jsxDEV("div",{className:"col",children:e.jsxDEV("div",{className:"row my-5",children:[e.jsxDEV("div",{className:"col-12 col-md-6 d-flex justify-content-center justify-content-md-end order-md-1",children:e.jsxDEV(t.SzButton,{variant:"contained",border:"soft",className:"my-2",type:"submit",isDisabled:I,loader:x,children:o("photoMeter.indexEntryModal.confirm")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:116,columnNumber:21},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:115,columnNumber:19},this),e.jsxDEV("div",{className:"col-12 col-md-6 d-flex justify-content-center justify-content-md-start order-md-0",children:e.jsxDEV(t.SzButton,{id:"modify-entry",variant:"text",className:"my-2",icon:g?"arrow-left":"",onClick:y,children:o("photoMeter.indexEntryModal.editInput")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:128,columnNumber:21},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:127,columnNumber:19},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:114,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:113,columnNumber:15},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:84,columnNumber:13},this)}},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:64,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:63,columnNumber:5},this);return e.jsxDEV(t.SzModal,{show:v,handleClose:y,size:"lg",backdrop:"static",className:"modal-index",fullscreen:"md",title:"",centered:!0,children:O},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntryModal.jsx",lineNumber:148,columnNumber:5},this)}const ee="BAI",Ie="HAU";function Ge(){const c=J(),v=je(),{t:r}=Z(),{reference:M}=Me(),y=Y(),[g,o]=a.useState(null),[z,I]=a.useState(null),[B,D]=a.useState(!1),x=r("photoMeter.indexEntry.errorLength"),l=r("photoMeter.indexEntry.errorRequired"),S="newidx_inf_lastidx",T="out_of_bounds_min",C="out_of_bounds_max",k="session_expired",P=5,V=we({input0:b().length(1,x).required(l),input1:b().length(1,x).required(l),input2:b().length(1,x).required(l),input3:b().length(1,x).required(l),input4:b().length(1,x).required(l)}),u={input0:a.useRef(null),input1:a.useRef(null),input2:a.useRef(null),input3:a.useRef(null),input4:a.useRef(null)},{data:O}=fe("getDataSession",p.getDataSession,{onSuccess:s=>{h.mutate(s)}}),{data:n={},...h}=q(s=>p.getConsommation(s.numeroCompteur),{onSuccess:(s,m)=>{s.isError?o(s.errorMessage):R.mutate(m)},onError:()=>{o(r("photoMeter.indexEntry.technicalError"))}}),{data:f={},...R}=q(s=>p.getDeposeInfo(s.numeroCompteur,s.rangCompteur),{onSuccess:s=>{s.isError&&o(s.errorMessage)},onError:()=>{o(r("photoMeter.indexEntry.technicalError"))}}),{isLoading:se,data:te={},...A}=q(s=>p.checkIndexEntry(s),{onSuccess:(s,{indexSaisi:m})=>{if(s.isError){const d=s.errorMessage===T,w=s.errorMessage===C;if(d||w){const N=d?ee:Ie,j={horsBorne:!0,motifIndex:N};p.updateSession(j),I(N),D(!0)}else k===s.errorMessage?o(r("errors.techErrorContactCustomerService")):S!==s.errorMessage&&o(s.errorMessage)}else{const d={index:String(m)};p.updateSession(d).then(()=>{y.push(Q.PHOTO_COUNTER_PHOTO.replace(":reference",M))})}}}),re=s=>{const m=Object.values(s).join(""),{borneMin:d,borneMax:w}=f,{qualiteIndex:N,indexCompteur:j}=n,H={indexSaisi:m,lastIndexQuality:N,lastIndex:j,borneMin:d,borneMax:w};A.mutate(H)},oe=()=>{D(!1)};return n.isError||f.isError||g?e.jsxDEV(K,{message:n.errorMessage??f.errorMessage??g,indiceError:0},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:167,columnNumber:7},this):e.jsxDEV("div",{className:"tsme-container step-depose-index px-2",children:[e.jsxDEV("div",{className:"d-flex justify-content-center mt-md-2",children:e.jsxDEV(be,{indice:0},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:179,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:178,columnNumber:7},this),e.jsxDEV(G,{initialValues:{input0:"",input1:"",input2:"",input3:"",input4:""},validationSchema:V,validateOnChange:!1,validateOnBlur:!1,onSubmit:re,children:({values:s,errors:m,handleChange:d,handleSubmit:w,setErrors:N,resetForm:j})=>{const H=Object.values(s).join(""),{errorMessage:ne}=te,F=ne===S,L=Object.keys(m).length>0,U=L||F,X=V.isValidSync(s),ae=!X,ie=X,le=i=>{i.preventDefault(),i.stopPropagation();const{value:E,name:_}=i.target,de=/^\d?$/,$=Object.keys(u).indexOf(_)+1,ce=Object.keys(u).length,xe="input"+$;if(m[_]){const W={...m};delete W[_],N(W)}(de.test(E)||s[_].toString().length>E.toString().length)&&(d(i),$<ce&&E.length>0&&u[xe].current.focus())},me=()=>{j({errors:{}}),A.reset(),u.input0.current.focus()},ue=h.isLoading||R.isLoading;return e.jsxDEV("form",{onSubmit:w,children:[e.jsxDEV(t.SzBox,{className:"rounded-2 bg-white shadow-sm mt-3",children:e.jsxDEV("div",{className:`col-12 col-md-10 m-auto ${c?"py-4":"py-3"}`,children:[e.jsxDEV(t.SzTypographie,{weight:c?"medium":"regular",children:r("photoMeter.indexEntry.blackDigits")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:253,columnNumber:19},this),e.jsxDEV("div",{className:pe("row no-gutters pt-md-4 pb-md-3",{"bg-light-grey":c}),children:[v&&e.jsxDEV("div",{className:"col-12",children:e.jsxDEV(t.SzTypographie,{weight:"bold",className:"d-md-none",children:r("photoMeter.indexEntry.meterNum",{num:O.matriculeCompteur})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:263,columnNumber:25},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:262,columnNumber:23},this),c&&e.jsxDEV("div",{className:"col-4 px-4",children:e.jsxDEV(t.SzData,{icon:"gauge-dashboard-1",children:[e.jsxDEV(t.SzData.Text,{children:r("photoMeter.indexEntry.numMeter")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:273,columnNumber:27},this),e.jsxDEV(t.SzData.Title,{children:O.matriculeCompteur},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:276,columnNumber:27},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:272,columnNumber:25},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:271,columnNumber:23},this),e.jsxDEV("div",{className:"col-12 col-md-8 px-md-4",children:[e.jsxDEV("div",{className:"row",children:e.jsxDEV("div",{className:"col-12",children:[Object.keys(u).map(i=>e.jsxDEV(t.SzInput,{ref:u[i],name:i,value:s[i],onChange:le,placeholder:"-",className:"p-0 border-blue-4 rounded number-box mr-2 text-center",pattern:"^\\d?$",maxLength:1,error:U},i,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:286,columnNumber:29},this)),Array.from({length:3}).map((i,E)=>e.jsxDEV(t.SzInput,{className:"p-0 rounded fixed-box mr-2 text-center",value:"X",disabled:!0},E,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:300,columnNumber:29},this)),c&&ie&&e.jsxDEV(t.SzButton,{variant:"text",id:"form-reset",icon:"diagram-round",onClick:me},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:309,columnNumber:29},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:284,columnNumber:25},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:283,columnNumber:23},this),e.jsxDEV("div",{className:"row",children:e.jsxDEV("div",{className:"col-12",children:U&&e.jsxDEV(t.SzAlert,{variant:"danger",className:"m-0 mt-4 rounded-1",children:[L&&l,F&&r("photoMeter.indexEntry.errorInf")]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:321,columnNumber:29},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:319,columnNumber:25},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:318,columnNumber:23},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:282,columnNumber:21},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:256,columnNumber:19},this),e.jsxDEV("div",{"data-cy":"lastReading",className:"col-12 px-0 px-md-4 mt-3",children:e.jsxDEV(t.SzTypographie,{weight:"medium",className:`d-flex align-items-center ${v?"color-gray-01":""}`,children:[e.jsxDEV(t.SzIcon,{variant:"line",icon:"messages-bubble-question",className:"d-none d-md-block mr-2 grey-01"},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:344,columnNumber:23},this),n.dateIndex&&r("photoMeter.indexEntry.lastReading",{date:he(new Date(n.dateIndex.date),Ne)}),e.jsxDEV("strong",{className:"ml-1",children:(n==null?void 0:n.indexCompteur)&&n.indexCompteur.toString().padStart(P,"0")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:356,columnNumber:23},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:338,columnNumber:21},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:334,columnNumber:19},this),e.jsxDEV("div",{className:"col-12 d-flex justify-content-center",children:e.jsxDEV(t.SzHelper,{className:"mt-4",title:r("photoMeter.landingPage.help.title"),type:"btn",label:r("photoMeter.indexEntry.helper"),children:e.jsxDEV(ye,{imageReleveIndex:Ee},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:371,columnNumber:23},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:365,columnNumber:21},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:364,columnNumber:19},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:248,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:247,columnNumber:15},this),e.jsxDEV("div",{className:"mt-3 text-center",children:e.jsxDEV(t.SzButton,{variant:"contained",border:"soft",type:"submit",loader:se||ue,isDisabled:L||ae,children:r("photoMeter.indexEntry.continue")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:377,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:376,columnNumber:15},this),e.jsxDEV(ge,{isShow:B,reference:M,indexSaisi:H,outOfBoundsWayForModal:z,handleClose:oe},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:387,columnNumber:15},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:246,columnNumber:13},this)}},void 0,!1,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:181,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/photoMeter/IndexEntry.jsx",lineNumber:177,columnNumber:5},this)}export{ee as bai,Ge as default,Ie as hau};
