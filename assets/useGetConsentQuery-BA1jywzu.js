import{j as e,c as x,b as w}from"./index-BAjkLHRS.js";import"./index-Djf8kdDz.js";import{ah as $,ai as y,aj as T,k as E,A as k,ak as z,l as D,M as F,I as M,h as L}from"./react-spring-web.esm-BXduOQz-.js";import{u as O}from"./useQueryObserver-JDa9NgZY.js";import{u as S}from"./useTranslation-Cclpl_OC.js";const J=(t={})=>Object.entries(t).map(([n,a])=>{const s={typeUsage:n};return s.codeUsages=a.map(r=>(s.titreTypeUsage=r.titreTypeUsage,r)),s}),X=({data:t})=>{if((t==null?void 0:t.length)>0){let n={};return t==null||t.forEach(({codeUsages:a,typeUsage:s})=>{a==null||a.forEach(({valeurUsage:r,codeUsage:o})=>{if(s&&o){const l=[!0,!1].includes(r),i=$("consent.status",{context:r?"yes":"no"});n[s]={...n[s],[o]:l?i:""}}})}),n}},Y=({consents:t,isCGU:n})=>{if(!t||Object.keys(t).length===0)return null;const{"OPT-IN":a,DEFAULT:s}=t,r=y(a,"OPT-IN"),o=y(s,"DEFAULT");if(n&&!r&&!o)return T;const l=r||o||null;return n&&l?l.concat(T):l},Z=({params:t,reference:n,codeParcours:a})=>{var s;if(t){let r={codeUsages:[]};const o={oui:"1",non:"0"},{statusConsents:l,"g-recaptcha-response":i}=t;for(const m in l)for(const c in l[m]){const u=o[l[m][c]]||null;if(u==="1"||u==="0"){const f={label:"ALL",valeur:{valeurUsage:u,valeurMedia:a==="landingPage"?"landing_page":a}};a||(s=f.valeur)==null||delete s.valeurMedia;const d={label:c,valeurs:[f]};r.codeUsages.push(d)}}return a&&(r.codeParcours=a),n&&(r.reference=n),i&&(r["g-recaptcha-response"]=i),r}},R=()=>E.get(k.GET_VALIDE_CGU,{baseURL:""});function _({name:t,options:n=[],onChange:a,selected:s,error:r}){const{t:o}=S();return e.jsxDEV("div",{className:"d-flex flex-column align-items-lg-center",children:[e.jsxDEV("div",{className:"d-flex flex-row flex-lg-column align-items-lg-center mb-1 mb-lg-0",children:[e.jsxDEV("div",{className:x("d-flex align-content-center switch-selector-wrapper",{"border border-1 border-red-02":r,"bg-green-05":s==="oui","bg-gray-04":s==="non","bg-gray-05":!s}),"data-cy":"consent-toggle",children:e.jsxDEV("div",{className:"select-option",children:n.map((l,i)=>{const m=`${t}-${i}`,c=l.initialCheck||s===l.value;return e.jsxDEV("label",{className:x("option-label",{"selected-option":c,"on-top":!c,"option-label small-width":!s}),children:e.jsxDEV("input",{type:"radio",id:m,name:t,onChange:u=>{a(t,u)},value:l.value,checked:c,className:x({"size-lg":l.value!==z})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:61,columnNumber:19},this)},m,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:53,columnNumber:17},this)})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:47,columnNumber:11},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:35,columnNumber:9},this),e.jsxDEV(w.SzTypographie,{className:"text-gray-600 ml-2 ml-lg-0",tag:"span",id:"consent-label",children:s||o("signUp.consents.notReplied")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:79,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:34,columnNumber:7},this),r&&e.jsxDEV(w.SzTypographie,{tag:"span",variant:"caption",size:"M",weight:"regular",className:"consent-none-selected-error text-red-02",children:o("consent.error_none_selected")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:88,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:33,columnNumber:5},this)}function A({cguOnly:t,cguLink:n,queryName:a}){var p;const{t:s}=S(),{values:r,setFieldValue:o,handleChange:l,errors:i,touched:m}=D(),{data:c,...u}=O(a),f=[{label:s("no"),value:"non"},{label:s("signUp.consents.notReplied"),value:z,initialCheck:!0},{label:s("yes"),value:"oui"}],{statusConsents:d,cguValue:v,cgu:g}=r,j=(N,b)=>{const[h,C]=N.split("#"),{value:V}=b.target;o("statusConsents",{...d||{},[h]:{...d[h]||{},[C]:V}})};return u.isLoading||t?null:e.jsxDEV(e.Fragment,{children:[Object.entries(((p=c==null?void 0:c.data)==null?void 0:p.typesUsages)||{}).map(([N,b],h)=>{const C=`${N}-${h}`;return e.jsxDEV("div",{className:x("bloc-consent",{"mt-3 mt-lg-5":h===1}),children:[e.jsxDEV(w.SzTypographie,{variant:"H5",size:"L",className:"text-uppercase mb-3",id:`title-${N}`,children:b[h].titreTypeUsage},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:67,columnNumber:15},this),e.jsxDEV("div",{className:"item-consent",children:b.map((V,I)=>e.jsxDEV(Q,{itemConsent:V,typeUsage:N,totalItems:b.length,itemKey:I,options:f,changeHandler:j,errors:i,touched:m},`item-${I}`,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:78,columnNumber:21},this))},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:75,columnNumber:15},this)]},C,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:61,columnNumber:13},this)}),g&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV(w.SzCheckbox,{id:"cguValue",name:"cguValue",label:e.jsxDEV(w.SzTypographie,{className:"text-dark",children:e.jsxDEV(F,{content:s("consent.cgu.title",{cguLink:n})},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:103,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:102,columnNumber:15},this),type:"checkbox",checked:v,onChange:l,className:"mt-4 mt-lg-5"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:98,columnNumber:11},this),i.cguValue&&m.cguValue&&e.jsxDEV(w.SzTypographie,{weight:"regular",className:"text-red-02",tag:"span",children:s(i.cguValue)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:112,columnNumber:13},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:97,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:55,columnNumber:5},this)}function Q({itemConsent:t,typeUsage:n,itemKey:a,totalItems:s,options:r,changeHandler:o,errors:l,touched:i}){var v,g,j,p;const{values:{statusConsents:m}}=D(),{libelleUsage:c,codeUsage:u}=t||{},f=((g=(v=i==null?void 0:i.statusConsents)==null?void 0:v[n])==null?void 0:g[u])&&((p=(j=l==null?void 0:l.statusConsents)==null?void 0:j[n])==null?void 0:p[u]),d=`${n}#${u}`;return e.jsxDEV("div",{className:x("d-flex flex-column flex-lg-row align-items-lg-center",{"border-1 border-bottom pb-4":a<s-1,"pt-3":a===1}),"data-cy":`item-${d}`,children:[e.jsxDEV("div",{className:"col-lg-8 px-0",children:e.jsxDEV(w.SzTypographie,{weight:"regular",className:"text-dark mb-3 mb-lg-0",children:c},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:154,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:153,columnNumber:7},this),e.jsxDEV("div",{className:"col-lg-2 px-0 d-flex justify-content-lg-center ml-lg-auto",children:e.jsxDEV(_,{name:d,options:r.filter(N=>!m[n][u]||!(N!=null&&N.initialCheck)),onChange:o,selected:m[n][u],error:f},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:159,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:158,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:143,columnNumber:5},this)}function K({type:t,buttonSubmit:n,modalTitle:a,cguOnly:s,isLoading:r,cguLink:o,hideBtnSubmit:l=!1,width:i,setShowModal:m,queryName:c="getInfosPersoConsentQuery"}){const{t:u}=S();D();const f=t==="modal",d=f&&s;return e.jsxDEV(e.Fragment,{children:e.jsxDEV("div",{className:x("list-consents",{cguOnly:"cgu-only-content",fullWidth:i==="full"}),children:[f&&!s&&e.jsxDEV(w.SzTypographie,{className:x("modal-title",{cguOnly:"cgu-only-title"}),children:a||""},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:42,columnNumber:11},this),e.jsxDEV(A,{cguOnly:s,cguLink:o,isModal:f,queryName:c},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:49,columnNumber:9},this),f&&e.jsxDEV(U,{cguLink:o,isCGUOnly:d},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:56,columnNumber:21},this),!l&&e.jsxDEV("div",{className:"d-flex",children:e.jsxDEV(w.SzButton,{variant:"contained",className:(n==null?void 0:n.position)==="left"?"ml-4":"mx-auto",type:"submit",loader:r,"data-cy":"consents-submit-btn",border:"soft",onClick:()=>{s&&(R(),m(!1))},children:u(d?"consent.approuve":"consent.submit")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:60,columnNumber:13},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:59,columnNumber:11},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:35,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:34,columnNumber:5},this)}function G(t){const{data:n}=L("getContentCgu",()=>E(t,{baseURL:""}));return n?new DOMParser().parseFromString(n.data,"text/html").querySelector(".intro").parentElement.innerHTML:""}function U({cguLink:t,isCGUOnly:n}){const a=G(t);return(a==null?void 0:a.length)>0&&n?e.jsxDEV("div",{className:"cgu-content",children:e.jsxDEV(M,{content:a,noWrap:!0},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:103,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:102,columnNumber:7},this):null}function ee({params:t,options:n,queryName:a="getConsentQuery"}){return L(a,()=>E.get(k.GET_CONSENT,{params:t}),n)}export{A as C,Z as a,U as b,K as c,J as f,Y as g,X as i,ee as u};
