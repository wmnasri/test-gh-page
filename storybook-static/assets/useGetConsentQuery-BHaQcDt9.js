import{j as e,c as x,b as w}from"./index-BzhTyqaY.js";import"./index-0X8QCd_i.js";import{D as $,G as k}from"./main-BbuvrTKi.js";import{u as z}from"./useQuery-DDRZMcvI.js";import{u as E}from"./formik.esm-DgjVmEdT.js";import{M as F,I as M}from"./index-E8Xemi00.js";import{a as D,A as L}from"./AxiosInstance-BZZbXQ8a.js";import{p as y,q as T}from"./react-spring-web.esm-DsMzZgQq.js";import{u as O}from"./useQueryObserver-BYynaL_B.js";import{u as S}from"./useTranslation-BYGhmYBG.js";const ee=(t={})=>Object.entries(t).map(([n,r])=>{const s={typeUsage:n};return s.codeUsages=r.map(o=>(s.titreTypeUsage=o.titreTypeUsage,o)),s}),se=({data:t})=>{if((t==null?void 0:t.length)>0){let n={};return t==null||t.forEach(({codeUsages:r,typeUsage:s})=>{r==null||r.forEach(({valeurUsage:o,codeUsage:l})=>{if(s&&l){const a=[!0,!1].includes(o),i=$("consent.status",{context:o?"yes":"no"});n[s]={...n[s],[l]:a?i:""}}})}),n}},ne=({consents:t,isCGU:n})=>{if(!t||Object.keys(t).length===0)return null;const{"OPT-IN":r,DEFAULT:s}=t,o=y(r,"OPT-IN"),l=y(s,"DEFAULT");if(n&&!o&&!l)return T;const a=o||l||null;return n&&a?a.concat(T):a},te=({params:t,reference:n,codeParcours:r})=>{var s;if(t){let o={codeUsages:[]};const l={oui:"1",non:"0"},{statusConsents:a,"g-recaptcha-response":i}=t;for(const m in a)for(const c in a[m]){const u=l[a[m][c]]||null;if(u==="1"||u==="0"){const f={label:"ALL",valeur:{valeurUsage:u,valeurMedia:r==="landingPage"?"landing_page":r}};r||(s=f.valeur)==null||delete s.valeurMedia;const d={label:c,valeurs:[f]};o.codeUsages.push(d)}}return r&&(o.codeParcours=r),n&&(o.reference=n),i&&(o["g-recaptcha-response"]=i),o}},R=()=>D.get(L.GET_VALIDE_CGU,{baseURL:""});function _({name:t,options:n=[],onChange:r,selected:s,error:o}){const{t:l}=S();return e.jsxDEV("div",{className:"d-flex flex-column align-items-lg-center",children:[e.jsxDEV("div",{className:"d-flex flex-row flex-lg-column align-items-lg-center mb-1 mb-lg-0",children:[e.jsxDEV("div",{className:x("d-flex align-content-center switch-selector-wrapper",{"border border-1 border-red-02":o,"bg-green-05":s==="oui","bg-gray-04":s==="non","bg-gray-05":!s}),"data-cy":"consent-toggle",children:e.jsxDEV("div",{className:"select-option",children:n.map((a,i)=>{const m=`${t}-${i}`,c=a.initialCheck||s===a.value;return e.jsxDEV("label",{className:x("option-label",{"selected-option":c,"on-top":!c,"option-label small-width":!s}),children:e.jsxDEV("input",{type:"radio",id:m,name:t,onChange:u=>{r(t,u)},value:a.value,checked:c,className:x({"size-lg":a.value!==k})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:61,columnNumber:19},this)},m,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:53,columnNumber:17},this)})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:47,columnNumber:11},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:35,columnNumber:9},this),e.jsxDEV(w.SzTypographie,{className:"text-gray-600 ml-2 ml-lg-0",tag:"span",id:"consent-label",children:s||l("signUp.consents.notReplied")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:79,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:34,columnNumber:7},this),o&&e.jsxDEV(w.SzTypographie,{tag:"span",variant:"caption",size:"M",weight:"regular",className:"consent-none-selected-error text-red-02",children:l("consent.error_none_selected")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:88,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/SwitchSelector/index.tsx",lineNumber:33,columnNumber:5},this)}function A({cguOnly:t,cguLink:n,queryName:r}){var h;const{t:s}=S(),{values:o,setFieldValue:l,handleChange:a,errors:i,touched:m}=E(),{data:c,...u}=O(r),f=[{label:s("no"),value:"non"},{label:s("signUp.consents.notReplied"),value:k,initialCheck:!0},{label:s("yes"),value:"oui"}],{statusConsents:d,cguValue:v,cgu:g}=o,j=(N,b)=>{const[p,C]=N.split("#"),{value:V}=b.target;l("statusConsents",{...d||{},[p]:{...d[p]||{},[C]:V}})};return u.isLoading||t?null:e.jsxDEV(e.Fragment,{children:[Object.entries(((h=c==null?void 0:c.data)==null?void 0:h.typesUsages)||{}).map(([N,b],p)=>{const C=`${N}-${p}`;return e.jsxDEV("div",{className:x("bloc-consent",{"mt-3 mt-lg-5":p===1}),children:[e.jsxDEV(w.SzTypographie,{variant:"H5",size:"L",className:"text-uppercase mb-3",id:`title-${N}`,children:b[p].titreTypeUsage},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:67,columnNumber:15},this),e.jsxDEV("div",{className:"item-consent",children:b.map((V,I)=>e.jsxDEV(Q,{itemConsent:V,typeUsage:N,totalItems:b.length,itemKey:I,options:f,changeHandler:j,errors:i,touched:m},`item-${I}`,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:78,columnNumber:21},this))},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:75,columnNumber:15},this)]},C,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:61,columnNumber:13},this)}),g&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV(w.SzCheckbox,{id:"cguValue",name:"cguValue",label:e.jsxDEV(w.SzTypographie,{className:"text-dark",children:e.jsxDEV(F,{content:s("consent.cgu.title",{cguLink:n})},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:103,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:102,columnNumber:15},this),type:"checkbox",checked:v,onChange:a,className:"mt-4 mt-lg-5"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:98,columnNumber:11},this),i.cguValue&&m.cguValue&&e.jsxDEV(w.SzTypographie,{weight:"regular",className:"text-red-02",tag:"span",children:s(i.cguValue)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:112,columnNumber:13},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:97,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:55,columnNumber:5},this)}function Q({itemConsent:t,typeUsage:n,itemKey:r,totalItems:s,options:o,changeHandler:l,errors:a,touched:i}){var v,g,j,h;const{values:{statusConsents:m}}=E(),{libelleUsage:c,codeUsage:u}=t||{},f=((g=(v=i==null?void 0:i.statusConsents)==null?void 0:v[n])==null?void 0:g[u])&&((h=(j=a==null?void 0:a.statusConsents)==null?void 0:j[n])==null?void 0:h[u]),d=`${n}#${u}`;return e.jsxDEV("div",{className:x("d-flex flex-column flex-lg-row align-items-lg-center",{"border-1 border-bottom pb-4":r<s-1,"pt-3":r===1}),"data-cy":`item-${d}`,children:[e.jsxDEV("div",{className:"col-lg-8 px-0",children:e.jsxDEV(w.SzTypographie,{weight:"regular",className:"text-dark mb-3 mb-lg-0",children:c},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:154,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:153,columnNumber:7},this),e.jsxDEV("div",{className:"col-lg-2 px-0 d-flex justify-content-lg-center ml-lg-auto",children:e.jsxDEV(_,{name:d,options:o.filter(N=>!m[n][u]||!(N!=null&&N.initialCheck)),onChange:l,selected:m[n][u],error:f},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:159,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:158,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/ConsentInputs.tsx",lineNumber:143,columnNumber:5},this)}function re({type:t,buttonSubmit:n,modalTitle:r,cguOnly:s,isLoading:o,cguLink:l,hideBtnSubmit:a=!1,width:i,setShowModal:m,queryName:c="getInfosPersoConsentQuery"}){const{t:u}=S();E();const f=t==="modal",d=f&&s;return e.jsxDEV(e.Fragment,{children:e.jsxDEV("div",{className:x("list-consents",{cguOnly:"cgu-only-content",fullWidth:i==="full"}),children:[f&&!s&&e.jsxDEV(w.SzTypographie,{className:x("modal-title",{cguOnly:"cgu-only-title"}),children:r||""},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:42,columnNumber:11},this),e.jsxDEV(A,{cguOnly:s,cguLink:l,isModal:f,queryName:c},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:49,columnNumber:9},this),f&&e.jsxDEV(U,{cguLink:l,isCGUOnly:d},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:56,columnNumber:21},this),!a&&e.jsxDEV("div",{className:"d-flex",children:e.jsxDEV(w.SzButton,{variant:"contained",className:(n==null?void 0:n.position)==="left"?"ml-4":"mx-auto",type:"submit",loader:o,"data-cy":"consents-submit-btn",border:"soft",onClick:()=>{s&&(R(),m(!1))},children:u(d?"consent.approuve":"consent.submit")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:60,columnNumber:13},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:59,columnNumber:11},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:35,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:34,columnNumber:5},this)}function G(t){const{data:n}=z("getContentCgu",()=>D(t,{baseURL:""}));return n?new DOMParser().parseFromString(n.data,"text/html").querySelector(".intro").parentElement.innerHTML:""}function U({cguLink:t,isCGUOnly:n}){const r=G(t);return(r==null?void 0:r.length)>0&&n?e.jsxDEV("div",{className:"cgu-content",children:e.jsxDEV(M,{content:r,noWrap:!0},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:103,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/consent/index.jsx",lineNumber:102,columnNumber:7},this):null}function oe({params:t,options:n,queryName:r="getConsentQuery"}){return z(r,()=>D.get(L.GET_CONSENT,{params:t}),n)}export{A as C,te as a,U as b,re as c,ee as f,ne as g,se as i,oe as u};
