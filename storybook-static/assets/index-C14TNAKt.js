import{j as e,b as y,a as we,g as hs}from"./index-BzhTyqaY.js";import{R as te,r as g}from"./index-0X8QCd_i.js";import{B as vs}from"./index-D593oKY2.js";import{u as ne}from"./useResponsive-DQBhMvnf.js";import{aL as Es,u as gs,n as Ms,aM as Ps,R as m,J as Be,aN as L,V as ce,U as de,$ as Oe,aO as js}from"./main-BbuvrTKi.js";import{u as V,b as Z,g as Ee,a as X,A as F,C as Y,i as _s,S as Ts,R as As}from"./AxiosInstance-BZZbXQ8a.js";import{O as Ie,S as ke,B as Ds,F as ns}from"./formik.esm-DgjVmEdT.js";import{F as xe}from"./FormError-BtpZASc0.js";import{f as Ss,p as Vs,I as Cs}from"./PhoneInput-CWQsNAcr.js";import{d as pe,X as Pe,c as ks,t as os,T as Bs,L as Os,Y as Is,Z as Rs,R as Ys}from"./react-spring-web.esm-DsMzZgQq.js";import{F as Q}from"./index-BsXj3zEC.js";import{i as Ls,a as Fs,R as zs,I as Hs}from"./index-CTjy3iMP.js";import{S as _}from"./index-R4VhrMC6.js";import{u as ge}from"./useQueryObserver-BYynaL_B.js";import{u as je}from"./useQuery-DDRZMcvI.js";import{u as Ne,a as Ks,D as Us,M as Gs,b as Xs}from"./useSetOtp-CzAWukMa.js";import{u as ue}from"./useMutation-DnofRurj.js";import{u as C}from"./useTranslation-BYGhmYBG.js";import{B as Qe,u as Ws}from"./PaymentChoice-B26KIjmU.js";import"./index-m5SwaE3w.js";/* empty css              *//* empty css                         */import{A as ae}from"./index-CenKVISr.js";import{M as $s}from"./Tips-j9k3pi84.js";import{E as qs}from"./index-CrOxkS7a.js";import{u as Qs}from"./useSearchParams-D6beRwI4.js";import{M as Me}from"./index-E8Xemi00.js";import{u as Re}from"./useInterweave-MFQvh887.js";function is(n,s){var r=te.useRef(!1),t=Es(n,s),o=gs(),u=te.useState(o.isMutating(t)),a=u[0],p=u[1],d=te.useRef(t);d.current=t;var l=te.useRef(a);return l.current=a,te.useEffect(function(){r.current=!0;var c=o.getMutationCache().subscribe(Ms.batchCalls(function(){if(r.current){var i=o.isMutating(d.current);l.current!==i&&p(i)}}));return function(){r.current=!1,c()}},[o]),a}const Ze=new RegExp(`^[0-9A-Za-z ]{0,${Ps}}$`),le=Ie({name:ke().required("managePayments.form.errors.mandatory").matches(Ze,"payment.IBANForm.errors.owner_name"),surname:ke().required("managePayments.form.errors.mandatory").matches(Ze,"payment.IBANForm.errors.owner_surname")}),Ve=Ie({checkboxVerified:Ds().oneOf([!0],"payment.IBANForm.errors.checkboxVerified")});function rs(){return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(_,{className:"col-6 col-lg-4 mb-1 px-0",height:20},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:7,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-9 mb-3 px-0",height:50},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:8,columnNumber:7},this),e.jsxDEV(_,{className:"col-6 col-lg-4 mb-1 px-0",height:20},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:9,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-9 mb-3 px-0",height:50},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:10,columnNumber:7},this),e.jsxDEV(_,{className:"col-6 col-lg-4 mb-1 px-0",height:20},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:11,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-9 mb-4 px-0",height:50},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:12,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-10 mb-3 px-0",height:60},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:13,columnNumber:7},this),e.jsxDEV("div",{className:"col-12 col-lg-2"},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:14,columnNumber:7},this),e.jsxDEV(_,{className:"col-1 col-lg-1 mb-1 px-0",height:20},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:15,columnNumber:7},this),e.jsxDEV("div",{className:"col-11 col-lg-11"},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:16,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-11 mb-3 px-0",height:50},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:17,columnNumber:7},this),e.jsxDEV(_,{className:"col-2 col-lg-2 mb-1 px-0",height:20},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:18,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:6,columnNumber:5},this)}function Zs(){return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(_,{className:"col-4 mb-3",height:12},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:26,columnNumber:7},this),e.jsxDEV("div",{className:"col-8"},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:27,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-5 mr-lg-2 mb-3",height:200},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:28,columnNumber:7},this),e.jsxDEV(_,{className:"col-12 col-lg-6 ml-lg-2 mb-3",height:200},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:29,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/Skeleton/Payment/MyPaymentMode/index.tsx",lineNumber:25,columnNumber:5},this)}function ms(){const n=ne(),s=n?"124px":"186px",r=n?"276px":"186px";return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"d-flex flex-column flex-lg-row mb-3",children:[e.jsxDEV("div",{className:"col-12 col-lg-5 mb-3 mb-lg-0",children:e.jsxDEV(_,{height:s},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:14,columnNumber:11},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:13,columnNumber:9},this),e.jsxDEV("div",{className:"col-12 col-lg-7",children:e.jsxDEV(_,{height:r},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:17,columnNumber:11},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:16,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:12,columnNumber:7},this),e.jsxDEV("div",{className:"mb-3",children:e.jsxDEV("div",{className:"col-12",children:e.jsxDEV(_,{height:376},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:22,columnNumber:11},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:21,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:20,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/Skeleton/PaymentModePromotion/paymentModePromotion.tsx",lineNumber:11,columnNumber:5},this)}function fe(){var l;const n=V(),{pathname:s}=Z(),r=Ee(m.ACCOUNT_INVOICES,{modal:"modale-e-facture"}),t=Ee(m.ACCOUNT_INVOICES),o=[r,t],u=je("getModeListPayment",()=>X.get(F.PAYMENT.GET_PAYMENT_MODE_LIST),{onError:()=>{o.includes(s)||n.push(m.PAYMENT.ERROR)}}),{content:a}=((l=u==null?void 0:u.data)==null?void 0:l.data)||{},{paymentModesList:p={}}=a||{},[d]=Object.entries(p).find(([,c])=>c)||[null];return{...u,modeListPaymentData:a,promotedValue:d}}function Js({managePayment:n,paymentMode:s,eFacture:r,firstOrigin:t}){const o=V();return ue(u=>X.post(F.PAYMENT.POST_PAYMENT_MSG,u),{onSuccess:({data:u},a)=>{const{message:p}=u||"";if(p!==Y.OK){o.push({pathname:m.PAYMENT.ERROR});return}if(n!=null&&n.hasMandate){const d=r?"?payment_mode="+s+"&e-facture=true&mandat=false":"?payment_mode="+s+"&mandat=false";o.push({pathname:m.PAYMENT.CONFIRMATION,search:d})}else{const d={...a},l=/((X{4} ){5})/g,c=(a.iban||"").match(l);a.iban&&!c&&(a.iban.match(/.{1,4}/g)||[]).forEach(function(M,x){const f="iban_field_"+(x+1);d[f]=M});const i=`payment_mode=${s}`,b=r?`${i}&e-facture=true`:i;o.push({pathname:m.PAYMENT.MY_PAYMENT_METHOD,search:b,state:{origin:_e,firstOrigin:t,myPmtModeDatas:d}})}}})}function et(){const n=V();return ue(s=>X.post(F.DOCAPOSTE.POST_IBAN,s),{onError(){n.push({pathname:m.PAYMENT.ERROR_ETIP})}})}function D({children:n,...s}){return e.jsxDEV("div",{className:"payments-manage-block bg-white rounded-3 position-relative mb-lg-3 px-3 px-lg-6 py-4 py-lg-5",...s,children:n},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBox.tsx",lineNumber:9,columnNumber:5},this)}function st(n,s,r,t){const{t:o}=C();let u=new Array;const{monthlyPayment:a,directDebitPayment:p,etip:d,bankCardPayment:l,tipi:c}=n;return a===!0&&u.push({label:o("payment.list.label_monthlyPayment"),value:"monthlyPayment",text:o("payment.list.text_monthlyPayment",{monthlyAmount:r}),info:o("payment.list.info_monthlyPayment")}),p===!0&&u.push({label:o("payment.list.label_directDebitPayment"),value:"directDebitPayment",text:o("payment.list.text_directDebitPayment"),info:o("payment.list.info_directDebitPayment")}),d===!0&&t&&u.push({label:o("payment.list.label_etip"),value:"etip",text:o("payment.list.text_etip"),info:o("payment.list.info_etip",{context:s?"mandate":"no_mandate"})}),l===!0&&t&&u.push({label:o("payment.list.label_bankCardPayment"),value:"bankCardPayment",text:o("payment.list.text_bankCardPayment"),info:o("payment.list.info_bankCardPayment")}),c===!0&&t&&u.push({label:o("payment.list.label_tipi"),value:"tipi",text:o("payment.list.text_tipi"),info:o("payment.list.info_tipi")}),u}const tt=Ie({paymentMode:ke().required("managePayments.form.errors.select_option")});function ls(n){const{t:s}=C(),{track:r}=pe(),t=V(),{paymentModesList:o,hasEtipSignedValidMandate:u,monthlyPaymentAmount:a,allModes:p,from:d,setRunPaymentCB:l}=n,c=st(o,u,a,p),[i,...b]=c,[P,v]=g.useState(!1),M=Fe(),x=is({mutationKey:["getBankCard"]}),{isIntranet:f}=window.tsme_data,{setPayment:w}=g.useContext(Be),E={className:"choose-paiement-mode",label:s("payment.promotion.button"),align:"right",loader:P||x===1,disabled:f},N=({paymentMode:j})=>{switch(w({paymentMode:j}),r("PAYMENT_3",{mode_paiement:Pe[j]}),j!==L.BANK_CARD_PAYMENT&&v(!0),j){case L.MONTHLY_PAYMENT:t.push(m.PAYMENT.MY_PAYMENT_METHOD+"?payment_mode="+de+M,{origin:d});break;case L.DIRECT_DEBIT_PAYMENT:t.push(m.PAYMENT.MY_PAYMENT_METHOD+"?payment_mode="+ce+M,{origin:d});break;case L.ETIP:t.push(m.PAYMENT.ETIP,{origin:d});break;case L.TIPI:window.location.href=m.MANAGE_PAYMENTS_URL.TIPI;break;case L.BANK_CARD_PAYMENT:l(!0);break}};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mt-4","data-cy":"payment-list-title",children:e.jsxDEV(y.SzTypographie,{variant:"H2",size:"M",weight:"medium",className:"text-dark mb-0",children:s("payment.list.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:108,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:107,columnNumber:7},this),e.jsxDEV(ns,{initialValues:{paymentMode:"monthlyPayment"},validationSchema:tt,validateOnBlur:!0,validateOnChange:!1,onSubmit:N,children:({handleSubmit:j,values:T,setFieldValue:h,errors:k})=>e.jsxDEV("form",{onSubmit:j,children:[e.jsxDEV("div",{className:"my-4","data-cy":"promoted-pmt-mode",children:e.jsxDEV(Qe,{id:i.value,name:i.value,label:i.label,value:i.value,isReco:!0,children:[e.jsxDEV(y.SzTypographie,{variant:"body",size:"M",weight:"regular",className:"text-dark mt-1",children:i.text},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:138,columnNumber:19},this),e.jsxDEV("div",{className:"border-top-gray sz-border-1",children:e.jsxDEV("div",{className:"d-flex align-items-center mt-2",children:[e.jsxDEV(y.SzIcon,{variant:"line",icon:"information-circle",className:"sz-typo-body sm text-dark mr-2"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:148,columnNumber:23},this),e.jsxDEV(y.SzTypographie,{variant:"caption",size:"M",weight:"light",className:"text-dark",children:i.info},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:153,columnNumber:23},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:147,columnNumber:21},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:146,columnNumber:19},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:131,columnNumber:17},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:130,columnNumber:15},this),e.jsxDEV("div",{"data-cy":"other-pmt-mode-list",children:b.length&&b.map((U,S)=>{const{label:W,value:G,text:B}=U;return e.jsxDEV(Qe,{id:G,name:G,label:W,value:G,className:"my-4",children:e.jsxDEV(y.SzTypographie,{variant:"caption",size:"M",weight:"regular",className:"text-dark mt-1",children:B},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:178,columnNumber:25},this)},S,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:170,columnNumber:23},this)})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:165,columnNumber:15},this),e.jsxDEV(xe,{field:"paymentMode",customDisplay:k.paymentMode},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:190,columnNumber:15},this),e.jsxDEV(Q,{next:E},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:194,columnNumber:15},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:129,columnNumber:13},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:118,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PaymentList.tsx",lineNumber:106,columnNumber:5},this)}const at=n=>{const{name:s,address:r,reference:t}=n,{t:o}=C();return e.jsxDEV("div",{className:"border sz-border-1 rounded-2 px-4 py-3","data-cy":"summary-contract",children:[e.jsxDEV(y.SzData,{className:"mb-3",icon:"business-contract-handshake-sign",variant:"line",children:[e.jsxDEV(y.SzData.Text,{className:"sz-typo-caption md font-family-regular",children:o("managePayments.summary.contract_name")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:17,columnNumber:9},void 0),e.jsxDEV(y.SzData.Title,{className:"summary-contract-name",children:s},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:20,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:12,columnNumber:7},void 0),e.jsxDEV(y.SzData,{className:"mb-3",icon:"pin-location-1",variant:"line",children:[e.jsxDEV(y.SzData.Text,{className:"sz-typo-caption md font-family-regular",children:o("managePayments.summary.address")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:23,columnNumber:9},void 0),e.jsxDEV(y.SzData.Title,{className:"summary-contract-address new-line",children:r},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:26,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:22,columnNumber:7},void 0),e.jsxDEV(y.SzData,{icon:"house-3",variant:"line",children:[e.jsxDEV(y.SzData.Text,{className:"sz-typo-caption md font-family-regular",children:o("managePayments.summary.reference")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:29,columnNumber:9},void 0),e.jsxDEV(y.SzData.Title,{className:"summary-contract-reference",children:t},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:32,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:28,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/ContractSummary.tsx",lineNumber:11,columnNumber:5},void 0)},nt=n=>{const{t:s,i18n:r}=C(),[t,o]=g.useState(!1),{titleCode:u,amount:a,date:p,showEtip:d,paymentMode:l,computationModeCode:c,invoiceVariant:i,currentPaymentModeCode:b,showPayBillButton:P}=n,v=`payment.summary_box.debit_type_${b}`,M=b&&r.exists(v)?s(v):void 0,{isIntranet:x}=window.tsme_data,w=u?["04","06","07"].includes(u):null,N=u?["01","02","04","08","09",de,Oe].includes(u):null,j=we("summary-payment-block rounded-2 d-flex",{"col-12 col-lg-5 bg-gray-100 mt-3 mt-lg-0 p-3 p-lg-4 align-items-center":!i,"w-100 bg-white px-3 py-4 p-lg-5 mt-3 mt-lg-4 d-flex flex-column":i}),T=we("mb-0",{"text-dark":!i,"text-expert-blue":i}),h=we("text-expert-blue",{"mb-2":!i,"my-3":i}),k=we("text-dark mb-0",{"mt-auto":!i,"mt-2":i}),U=()=>{o(!0),window.location.href=m.PAYMENT.INDEX};return e.jsxDEV("div",{className:j,"data-cy":"summary-payment-block",children:[e.jsxDEV("div",{className:"d-flex flex-column justify-content-center h-100","data-cy":"summary-payment",children:[u&&e.jsxDEV(y.SzTypographie,{variant:i?"H3":"body",size:i?"L":"S",weight:"medium",className:T,children:s("payment.summary_box.paymentInfo.headline",{context:u})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:89,columnNumber:11},void 0),N&&e.jsxDEV(y.SzTypographie,{variant:"H2",size:"XL",weight:"bold",className:h,children:s("payment.summary_box.paymentInfo.amount",{amount:a,context:u})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:101,columnNumber:11},void 0),ce===l&&e.jsxDEV(y.SzTypographie,{size:"M",weight:"bold",className:"text-expert-blue",children:s("payment.summary_box.paymentInfo.amount",{context:l})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:114,columnNumber:11},void 0),(w||c)&&e.jsxDEV(y.SzTypographie,{variant:"caption",size:"M",weight:"regular",className:k,children:[w&&s("payment.summary_box.paymentInfo.comment",{context:u,amount:a,date:p}),c&&s("payment.summary_box.paymentInfo.comment_mensualisation",{context:c})]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:121,columnNumber:11},void 0),d&&!x&&!i&&e.jsxDEV(ks,{icon:"keyboard-arrow-right",className:"mt-auto pl-0 h-25 text-left justify-content-start",variant:"text",alignIcon:"right",to:m.PAYMENT.ETIP,"data-cy":"etip-payment-link",children:s("payment.summary_box.paymentInfo.etip_payment_button")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:140,columnNumber:11},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:84,columnNumber:7},void 0),i&&M&&e.jsxDEV("div",{className:"border-top border-1 border-gray-100 w-100 mt-3 pt-3",children:e.jsxDEV("p",{className:"text-break mb-0",children:[e.jsxDEV(y.SzTypographie,{variant:"body",className:"mb-0",tag:"span",children:s("payment.summary_box.payment_mode_label",{context:s("payment.summary_box.actual")})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:155,columnNumber:13},void 0),e.jsxDEV(y.SzTypographie,{variant:"body",weight:"bold",className:"mb-0",tag:"span",children:M},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:160,columnNumber:13},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:154,columnNumber:11},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:153,columnNumber:9},void 0),i&&P&&e.jsxDEV("div",{className:"mt-3",children:e.jsxDEV(y.SzButton,{variant:"outlined",border:"soft",onClick:U,loader:t,"data-cy":"pay-my-bill-button",children:s("payment.summary_box.paymentInfo.payment_button")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:173,columnNumber:11},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:172,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentBlock.tsx",lineNumber:83,columnNumber:5},void 0)};function ot({paymentMode:n,eFacture:s,onSuccess:r,onError:t,enabled:o}){return je("getManagePayment",()=>X.get(F.PAYMENT.GET_MANAGE_PAYMENT,{params:{paymentMode:Le[n],eInvoice:s}}),{onSuccess:r,onError:t,enabled:o})}function it({onSuccess:n,onError:s,enabled:r}){return je("getIban",()=>X.get(F.DOCAPOSTE.GET_CONTRACT_IBAN,{params:{enable_tracking:"1"}}),{onSuccess:n,onError:s,enabled:r})}const rt=({isOpen:n})=>{var x,f,w,E,N,j;const s=V(),[r,t]=g.useState(()=>n?"0":"1");g.useEffect(()=>{t(n?"0":"1")},[n]);const{t:o}=C(),{setManagePayment:u}=g.useContext(Ae),{paymentMode:a,eFacture:p}=Ne(),{data:d,isLoading:l}=ot({paymentMode:a,eFacture:p,onSuccess:({data:T})=>{T.content&&u(T.content)},onError:()=>{s.push(m.PAYMENT.ERROR)},enabled:a!==L.ETIP}),{content:c}=(d==null?void 0:d.data)||{},{data:i,isLoading:b}=it({onSuccess:({data:T})=>{const h={hasMandate:T.has_mandate,contractData:{reference:T.reference,iban:T.iban,ibanHolder:T.titulaire,contractName:T.name,balanceAmount:T.balance,siteAddress:T.site_address,balanceDate:""},monthlyPaymentData:{amount:"",computationModeLabel:"",computationModeCode:""}};u(h)},onError:()=>{s.push(m.PAYMENT.ERROR_ETIP)},enabled:a===L.ETIP}),P={amount:((x=c==null?void 0:c.monthlyPaymentData)==null?void 0:x.amount)||((f=i==null?void 0:i.data)==null?void 0:f.balance)||"",name:(c==null?void 0:c.contractData.contractName)||((w=i==null?void 0:i.data)==null?void 0:w.name)||"",address:(c==null?void 0:c.contractData.siteAddress)||((E=i==null?void 0:i.data)==null?void 0:E.site_address)||"",reference:(c==null?void 0:c.contractData.reference)||((N=i==null?void 0:i.data)==null?void 0:N.reference)||"",titleCode:a,paymentMode:a,computationModeCode:(j=c==null?void 0:c.monthlyPaymentData)==null?void 0:j.computationModeCode,paymentModeLabel:o("payment.summary_box.payment_mode_label",{context:"selected"}),paymentModeValue:o("payment.summary_box.debit_type",{context:Le[a]}),showEtip:!1,paymentModeShow:!0},v=[{fields:{title:o("payment.summary_box.title"),content:e.jsxDEV(Ye,{...P},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:111,columnNumber:18},void 0)}}],M=T=>{t(T)};return l||b?e.jsxDEV(D,{"data-cy":"my-payment-loading",children:e.jsxDEV(Zs,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:123,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:122,columnNumber:7},void 0):e.jsxDEV("div",{className:"payments-manage-block",children:e.jsxDEV(qs,{data:v,className:"rounded-3 mb-3",activeKey:r,setCurrentKey:M,toggle:!1,borderBottom:!1,buttonArrow:!0,isHistory:!0},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:130,columnNumber:7},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:129,columnNumber:5},void 0)},Ye=n=>{const{titleCode:s,amount:r,date:t,showEtip:o,paymentMode:u,computationModeCode:a,name:p,address:d,reference:l,paymentModeShow:c,paymentModeLabel:i,paymentModeValue:b}=n,P={titleCode:s,amount:r,date:t,showEtip:o,paymentMode:u,computationModeCode:a};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"d-flex flex-column flex-lg-row mb-3",children:[e.jsxDEV(nt,{...P},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:172,columnNumber:9},void 0),e.jsxDEV("div",{className:"col-12 col-lg-7 pt-3 px-0 pt-lg-0 pl-lg-3 pr-lg-0",children:e.jsxDEV(at,{name:p,address:d,reference:l},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:174,columnNumber:11},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:173,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:171,columnNumber:7},void 0),c&&e.jsxDEV("div",{className:"row no-gutters","data-cy":"payment-mode",children:[e.jsxDEV(y.SzTypographie,{variant:"body",className:"text-dark mb-0",children:i},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:183,columnNumber:11},void 0),e.jsxDEV(y.SzTypographie,{variant:"body",weight:"bold",className:"text-dark ml-lg-1 mb-0",children:b},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:186,columnNumber:11},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:182,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/SummaryBox.tsx",lineNumber:170,columnNumber:5},void 0)};function us({launch:n,setRunPaymentCB:s}){var v,M;Ws();const r=V(),[t,o]=g.useState(!1),{mutate:u,isLoading:a,isSuccess:p,data:d}=ue(()=>X.get(F.PAYMENT.BANK_CARD,{baseURL:""}),{mutationKey:"getBankCard",onSuccess:x=>{var w;const f=(w=x==null?void 0:x.data)==null?void 0:w.code;Y.CODE_DOMAIN_ERROR===f&&r.push(m.PAYMENT.CONFIRMATION_CB_FAILED)},onError:()=>{r.push(m.PAYMENT.CONFIRMATION_CB_FAILED)}}),l=ue(()=>X.get(F.PAYMENT.CHECK_PAYLINE),{onSuccess:(x,{callSubmitPayment:f})=>{var w;if(f)u();else{const{isRedirect:E,redirect:N}=(w=x==null?void 0:x.data)==null?void 0:w.content;E===!0&&N&&(window.location.href=N)}},onError:()=>{r.push(m.PAYMENT.CONFIRMATION_CB_FAILED)}}),c=document==null?void 0:document.getElementById("pl-container-lightbox-close"),i=d,b=p&&i?(M=(v=i==null?void 0:i.data)==null?void 0:v.content)==null?void 0:M.paylineToken:"",P=()=>{Payline.Api.endToken(),l.mutate({}),s(!1),o(!1)};return g.useEffect(()=>{if(b){const x=setTimeout(()=>{Payline.Api.reset(b),o(!0)},1e3);return()=>{clearTimeout(x)}}},[a]),g.useEffect(()=>{const x=setTimeout(()=>{c==null||c.addEventListener("click",P)},1e3);return()=>{c==null||c.removeEventListener("click",P),clearTimeout(x)}},[t]),hs(27,()=>{t&&c&&(Payline.Api.endToken(),l.mutate({}),s(!1),o(!1))}),g.useEffect(()=>{n&&l.mutate({callSubmitPayment:!0})},[n]),e.jsxDEV("div",{id:"PaylineWidget","data-token":b,"data-embeddedredirectionallowed":"false","data-auto-init":"false"},void 0,!1,{fileName:"/usr/var/www/assets/js/components/payment/PaylineMonext.tsx",lineNumber:126,columnNumber:5},this)}const Ce="M",Je="P",es="?payment_mode=",he="promotionBlock",mt=()=>{const{t:n}=C(),{track:s}=pe(),r=V(),[t,o]=g.useState(!1),[u,a]=g.useState(!1),[p,d]=g.useState(!1),{modeListPaymentData:l,isLoading:c,promotedValue:i}=fe(),b=is({mutationKey:["getBankCard"]}),{setPayment:P}=g.useContext(Be);if(c||!l)return e.jsxDEV(D,{"data-cy":"my-payment-promo-loading",children:e.jsxDEV(ms,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:45,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:44,columnNumber:7},void 0);const{currentPaymentModeCode:v}=l,M=[Ce,Je].includes(v);if(!i&&!M)return s("PAYMENT_4",{mode_paiement:"",iban_mandat:"",code_erreur:"paiements_indisponibles"}),e.jsxDEV(_s,{to:m.PAYMENT.UNAVAILABLE_PMT_MODE},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:61,columnNumber:12},void 0);const x={name:l.contractBlock.name,address:l.contractBlock.siteAddress,reference:l.contractBlock.fullReference,titleCode:l.grayBlock.titleCode,amount:l.grayBlock.content.amount,date:l.grayBlock.content.date,showEtip:l.hasEtipSignedValidMandate,paymentModeShow:p?!1:M,paymentModeLabel:n("payment.summary_box.payment_mode_label",{context:n("payment.summary_box.actual")}),paymentModeValue:n("payment.summary_box.debit_type",{context:v})},f={paymentModesList:l.paymentModesList,hasEtipSignedValidMandate:l==null?void 0:l.hasEtipSignedValidMandate,monthlyPaymentAmount:l==null?void 0:l.monthlyPaymentAmount,allModes:!0,from:he},E=Object.values(l.paymentModesList).filter(B=>B).length>=2,N=i?"":n("payment.promotion.alreadyBestMode",{context:v===Ce?Ce:Je}),j={context:i},T=n("payment.promotion.tips",j),h=i&&!["etip","bankCardPayment"].includes(i),k=n("payment.promotion.text_other_info_etip",{context:l.hasEtipSignedValidMandate?"mandat":"no_mandat"}),U=()=>{switch(i!==null&&(P({paymentMode:i}),s("PAYMENT_1",{mode_paiement:Pe[i]})),i!==L.BANK_CARD_PAYMENT&&o(!0),i){case L.MONTHLY_PAYMENT:r.push({pathname:m.PAYMENT.MY_PAYMENT_METHOD,search:es+de,state:{origin:he}});break;case L.DIRECT_DEBIT_PAYMENT:r.push({pathname:m.PAYMENT.MY_PAYMENT_METHOD,search:es+ce,state:{origin:he}});break;case L.ETIP:window.location.href=m.PAYMENT.ETIP;break;case L.TIPI:window.location.href=m.MANAGE_PAYMENTS_URL.TIPI;break;case L.BANK_CARD_PAYMENT:a(!0);break}},S={label:n("payment.promotion.button"),align:"right",loader:t||b===1,onClick:U},W=()=>{s("PAYMENT_2"),d(!0)},G={id:"allPaymentMods",label:n("payment.promotion.buttonOtherPayments"),align:"right",variant:"tertiary",arrow:!0,onClick:W};return e.jsxDEV(D,{children:[e.jsxDEV(us,{launch:u,setRunPaymentCB:a},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:172,columnNumber:7},void 0),e.jsxDEV(Ye,{...x},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:174,columnNumber:7},void 0),p?e.jsxDEV(ls,{setRunPaymentCB:a,...f},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:177,columnNumber:9},void 0):i?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"promotionBlock border sz-border-1 border-expert-blue rounded-2 px-4 py-3 mt-3",children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-1",children:n("payment.promotion.title",j)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:181,columnNumber:13},void 0),e.jsxDEV(y.SzTypographie,{variant:"body",className:"text-dark mb-3",children:n("payment.promotion.description",{...j,monthlyAmount:l.monthlyPaymentAmount})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:189,columnNumber:13},void 0),h&&e.jsxDEV($s,{isGoodToKnow:!1,className:"mb-3",children:T},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:196,columnNumber:15},void 0),e.jsxDEV("div",{className:"d-flex flex-row align-items-center top-grey-line pt-2",children:[e.jsxDEV(y.SzIcon,{variant:"line",icon:"information-circle",className:"mr-3 mb-3 promotion-info-icon"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:201,columnNumber:15},void 0),e.jsxDEV(y.SzTypographie,{variant:"body",className:"text-dark promotion-info-text",children:n("payment.promotion.other_info",{...j,text_other_info_etip:k})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:206,columnNumber:15},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:200,columnNumber:13},void 0),e.jsxDEV(Q,{next:S},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:216,columnNumber:13},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:180,columnNumber:11},void 0),E&&e.jsxDEV(Q,{next:G},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:218,columnNumber:30},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:179,columnNumber:9},void 0):e.jsxDEV(ae,{variant:"info",className:"mt-4",children:N},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:221,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/PromotionBlock.tsx",lineNumber:171,columnNumber:5},void 0)};function cs(){const n=V(),{track:s}=pe(),{eFacture:r,isRouteEtip:t,paymentMode:o}=Ne(),{state:u,search:a}=Z(),{mobilePhone:p}=u.myPmtModeDatas,{managePayment:d}=g.useContext(Ae),l=Qs(),[c,i]=g.useState(!1),b=Ks({url:t?F.DOCAPOSTE.SIGN_MANDATE:F.PAYMENT.FINALIZE_PAYMENT_MSG,onSuccess:({data:f})=>{const{code:w,message:E}=f||"";if(t){if(w!==Y.SUCCESS&&w!==Y.INCORRECT_INPUT){n.push(m.PAYMENT.ERROR_ETIP);return}w===Y.INCORRECT_INPUT&&i(!0)}else if(E!==Y.OK&&E!==Y.KO_CODE_OTP){n.push(m.PAYMENT.ERROR);return}else E===Y.KO_CODE_OTP&&i(!0);(t?w===Y.SUCCESS:E===Y.OK)&&(r&&l.set("e-facture","true"),t&&l.set("payment_mode","etip"),l.set("mandat","true"),n.push({pathname:m.PAYMENT.CONFIRMATION,search:l.toString()}))},onError:({response:f})=>{var w;s("PAYMENT_4",{mode_paiement:o?Pe[o]:"",iban_mandat:"has_iban no_mandate",code_erreur:(w=f==null?void 0:f.data)==null?void 0:w.code}),t&&f.status===502&&f.data.code===Y.INCORRECT_INPUT||!t&&f.data.message===Y.KO_CODE_OTP?i(!0):t?n.push(m.PAYMENT.ERROR_ETIP):n.push(m.PAYMENT.ERROR)}}),P=()=>{const{myPmtModeDatas:f,firstOrigin:w}=u;t?n.push({pathname:m.PAYMENT.ETIP,state:{myPmtModeDatas:f,firstOrigin:w}}):n.push({pathname:m.PAYMENT.MY_PAYMENT_METHOD,search:l.toString(),state:{myPmtModeDatas:f,firstOrigin:w}})},v=f=>{const w=t?"sms_code":"otpCode";b.mutate({[w]:f==null?void 0:f.input})},M=t?F.DOCAPOSTE.DOWNLOAD_MANDATE_TPL:F.PAYMENT.GET_TEMPLATE_PAYMENT,x=f=>{os.fromFile(f)};return d?e.jsxDEV(D,{children:[e.jsxDEV(Us,{url:M,pathname:m.PAYMENT.ERROR,search:a,mobilePhone:p,isBlob:t,onSuccess:t?x:void 0},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SignMandate.tsx",lineNumber:133,columnNumber:7},this),e.jsxDEV(Gs,{onPrevClick:P,onSubmit:v,mobilePhone:p,errorReset:c,setErrorReset:i,loadingSubmit:b.isLoading},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SignMandate.tsx",lineNumber:141,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SignMandate.tsx",lineNumber:132,columnNumber:5},this):e.jsxDEV(D,{"data-cy":"sign-mandate-loading",children:e.jsxDEV(rs,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SignMandate.tsx",lineNumber:126,columnNumber:9},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SignMandate.tsx",lineNumber:125,columnNumber:7},this)}const lt="e-facture",ut="?payment_mode="+de,ct="?payment_mode="+ce,dt="Compliant",pt="Valid",Le={[de]:"M",[ce]:"P",[Oe]:"E"},ve="originMyPaymentMode",_e="manage",Fe=()=>{const{search:n}=Z(),r=new URLSearchParams(n).get(lt);return r==="false"||!r?"":"&e-facture=true"},Nt=()=>{var P,v,M,x,f,w,E,N;const{t:n}=C(),s=V(),r=Fe(),{modeListPaymentData:t,isLoading:o}=fe(),[u,a]=g.useState(!1);if(o||!t)return e.jsxDEV(D,{"data-cy":"my-payment-promo-loading",children:e.jsxDEV(ms,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:98,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:97,columnNumber:7},void 0);const{monthlyPayment:p,directDebitPayment:d}=t.paymentModesList;p&&!d?s.push(m.PAYMENT.MY_PAYMENT_METHOD+ut+r,{origin:ve}):!p&&d?s.push(m.PAYMENT.MY_PAYMENT_METHOD+ct+r,{origin:ve}):!p&&!d&&s.push(m.PAYMENT_INDEX);const l=t==null?void 0:t.currentPaymentModeCode,c={name:(P=t==null?void 0:t.contractBlock)==null?void 0:P.name,address:(v=t==null?void 0:t.contractBlock)==null?void 0:v.siteAddress,reference:(M=t==null?void 0:t.contractBlock)==null?void 0:M.fullReference,titleCode:(x=t==null?void 0:t.grayBlock)==null?void 0:x.titleCode,amount:(w=(f=t==null?void 0:t.grayBlock)==null?void 0:f.content)==null?void 0:w.amount,date:(N=(E=t==null?void 0:t.grayBlock)==null?void 0:E.content)==null?void 0:N.date,showEtip:t==null?void 0:t.hasEtipSignedValidMandate,paymentModeShow:!1,paymentModeLabel:n("payment.summary_box.payment_mode_label",{context:n("payment.summary_box.actual")}),paymentModeValue:n("payment.summary_box.debit_type",{context:l})},b={paymentModesList:{monthlyPayment:!0,directDebitPayment:!0},hasEtipSignedValidMandate:t==null?void 0:t.hasEtipSignedValidMandate,monthlyPaymentAmount:t==null?void 0:t.monthlyPaymentAmount,allModes:!0,from:ve};return e.jsxDEV(D,{children:[e.jsxDEV(us,{launch:u,setRunPaymentCB:a},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:149,columnNumber:7},void 0),e.jsxDEV(Ye,{...c},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:150,columnNumber:7},void 0),e.jsxDEV(ls,{setRunPaymentCB:a,...b},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:151,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:148,columnNumber:5},void 0)},ft=()=>{var He,Ke,Ue,Ge,Xe,We,$e,qe;const n=V(),{t:s}=C(),{track:r}=pe(),{link:t}=(Ue=(Ke=(He=window.tsme_data)==null?void 0:He.footer)==null?void 0:Ke.links_bottom)==null?void 0:Ue.privacy_policy,{state:o={},pathname:u}=Z(),{myPmtModeDatas:a}=o,p=u.includes(m.PAYMENT.ETIP),[d,l]=g.useState(!1),[c,i]=g.useState(!1),{paymentMode:b,eFacture:P}=Ne(),[v,M]=g.useState(),x=ge("getManagePayment"),f=ge("getIban"),w=!!((Ge=x.data)!=null&&Ge.data.content.contractData.iban)||!!((Xe=f.data)!=null&&Xe.data.iban),E=v===void 0?w:v,N=(We=f==null?void 0:f.data)==null?void 0:We.data,j=p&&(N==null?void 0:N.has_mandate)&&(N==null?void 0:N.status_mandate)===pt&&(N==null?void 0:N.is_iban_different_with_search_mandate)===!0,T={hasMandate:(N==null?void 0:N.has_mandate)&&(N==null?void 0:N.status_mandate)!==dt||!1,contractData:{reference:(N==null?void 0:N.reference)||"",iban:(N==null?void 0:N.iban)||"",ibanHolder:(N==null?void 0:N.titulaire)||"",contractName:(N==null?void 0:N.name)||"",balanceAmount:(N==null?void 0:N.balance)||"",siteAddress:(N==null?void 0:N.site_address)||"",balanceDate:""},monthlyPaymentData:{amount:"",computationModeLabel:"",computationModeCode:""}},h=($e=x.data)!=null&&$e.data.content?x.data.data.content:T,k=(qe=o==null?void 0:o.myPmtModeDatas)==null?void 0:qe.iban;g.useEffect(()=>{(k==null?void 0:k.match(/((X{4} ){5})/g))===null&&M(!1),k&&!(k!=null&&k.match(/(^FR|^..XX)/g))&&l(!0)},[k]);const U=o==null?void 0:o.origin,S=Js({managePayment:h,paymentMode:b,eFacture:P,firstOrigin:U}),W=et(),G=Xs(),B=!!(h!=null&&h.hasMandate),J=E&&!B,$=E&&B&&!j;let ye="edit";c?ye="modify":J?ye="complete":$&&(ye="validate");const ps=g.useCallback(()=>{const O=d?Ls(s):Fs(s),z=p?Ss():Vs(s);if(j&&w)return le.concat(Ve);if(j&&!w)return le.concat(O);if($)return Ve;if(J)return le.concat(z).concat(Ve);if(!E&&B)return le.concat(O);if(!E&&!B)return le.concat(z).concat(O)},[j,$,J,B,d,E]),Ns={label:s(p&&B?"managePayments.form.validate_and_pay":"managePayments.form.goNext"),align:"right",loader:p?W.isLoading||G.isLoading:S.isLoading},ze=Fe()!==""?"?e-facture=true":"",fs=()=>{const O=o.origin??o.firstOrigin;!E&&c?(M(!0),i(!1)):O===he?n.push(m.PAYMENT_INDEX+ze):O===ve&&n.push(Ee(m.PAYMENT.MY_PAYMENT_METHOD+ze))},ys={enabled:!0,disabled:S.isLoading,label:s("managePayments.form.goBack"),align:"left",onClick:fs},bs=()=>{r("PAYMENT_6"),M(!1),i(!0)},ws=({iban:O,surname:z,name:q,phoneNumber:ee,...oe},{setFieldError:se})=>{var ie,re,me;const De=Oe!==b,Se=O||((ie=h==null?void 0:h.contractData)==null?void 0:ie.iban)||"",be=Is(oe,"iban_field",js);if(De){const A={paymentMode:Le[b],iban:be||Se};z&&(A.firstName=z),q&&(A.lastName=q),ee&&(A.mobilePhone=ee),S.mutate(A,{onError:({response:H})=>{var K;const{data:I,status:R}=H;R===400&&((K=I==null?void 0:I.validation_errors)!=null&&K.mobilePhone)?se("phoneNumber",s("phoneNumber.errors.invalid")):R>=500&&n.push(m.PAYMENT.ERROR)}})}else{const A={};if(z&&(A.first_name=z),q&&(A.last_name=q),ee&&(A.mobile_phone=Rs(ee)),!z&&!q&&((re=h==null?void 0:h.contractData)!=null&&re.ibanHolder)&&(A.holder=(me=h==null?void 0:h.contractData)==null?void 0:me.ibanHolder),oe.iban_field_1)for(const[H,I]of Object.entries(oe))H.includes("iban_field_")&&(A[H]=I);W.mutate(A,{onSuccess:({data:H})=>{const{message:I}=H||"";if(I!==Y.OK){n.push({pathname:m.PAYMENT.ERROR_ETIP});return}h!=null&&h.hasMandate?n.push({pathname:m.PAYMENT.CONFIRMATION,search:"?payment_mode=etip&mandat=false"}):G.mutate(null,{onSuccess:()=>{const R={...A};A.hasOwnProperty("first_name")&&(R.firstName=A.first_name),A.hasOwnProperty("last_name")&&(R.lastName=A.last_name),A.hasOwnProperty("mobile_phone")&&(R.mobilePhone=A.mobile_phone),n.push({pathname:m.PAYMENT.ETIP,state:{origin:_e,firstOrigin:U,myPmtModeDatas:R}})}})},onError:({response:H})=>{var K;const{data:I,status:R}=H;R===400&&((K=I==null?void 0:I.validation_errors)!=null&&K.mobilePhone)?se("phoneNumber",s("phoneNumber.errors.invalid")):R>=500?n.push(m.PAYMENT.ERROR_ETIP):n.push(m.PAYMENT.ERROR_ETIP)}})}};return h.contractData.reference?e.jsxDEV(e.Fragment,{children:e.jsxDEV(D,{"data-cy":"my-payment-mode",children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-3 mb-lg-4",children:s("payment.IBANForm.title",{context:ye})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:456,columnNumber:9},void 0),e.jsxDEV(ns,{initialValues:{surname:(a==null?void 0:a.firstName)??(a==null?void 0:a.first_name)??"",name:(a==null?void 0:a.lastName)??(a==null?void 0:a.last_name)??"",phoneNumber:(a==null?void 0:a.mobilePhone)??(a==null?void 0:a.mobile_phone)??"",iban:(a==null?void 0:a.iban)??"",iban_field_1:(a==null?void 0:a.iban_field_1)??"",iban_field_2:(a==null?void 0:a.iban_field_2)??"",iban_field_3:(a==null?void 0:a.iban_field_3)??"",iban_field_4:(a==null?void 0:a.iban_field_4)??"",iban_field_5:(a==null?void 0:a.iban_field_5)??"",iban_field_6:(a==null?void 0:a.iban_field_6)??"",iban_field_7:(a==null?void 0:a.iban_field_7)??"",checkboxVerified:!1},validationSchema:ps,validateOnBlur:!0,validateOnChange:!1,onSubmit:ws,children:({errors:O,touched:z,handleBlur:q,handleChange:ee,handleSubmit:oe,values:se,setFieldValue:De})=>{var ie,re,me,A,H,I,R;const Se=({target:K})=>{De("checkboxVerified",K.checked,!0)},be=K=>{const{value:xs}=K.target;K.target.value=Ys(xs),ee(K)};return e.jsxDEV("form",{onSubmit:oe,children:[e.jsxDEV("div",{id:"owner-info",children:[(!E||!B||j)&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"col-12 col-lg-9 mb-3 px-0",children:[e.jsxDEV(y.SzInput,{name:"name",id:"name",value:se.name,autocomplete:"family-name",onChange:be,onBlur:q,label:s("payment.IBANForm.ownerName"),placeholder:s("customerService.placeholder_lastName"),variant:"outlined",valid:!O.name},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:509,columnNumber:25},void 0),e.jsxDEV(xe,{customDisplay:z.name&&O.name,field:"name"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:523,columnNumber:25},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:508,columnNumber:23},void 0),e.jsxDEV("div",{className:"col-12 col-lg-9 mb-3 px-0",children:[e.jsxDEV(y.SzInput,{name:"surname",id:"surname",value:se.surname,autocomplete:"given-name",onChange:be,onBlur:q,label:s("payment.IBANForm.ownerSurname"),placeholder:s("customerService.placeholder_firstName"),variant:"outlined",valid:!O.surname},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:529,columnNumber:25},void 0),e.jsxDEV(xe,{customDisplay:z.surname&&O.surname,field:"surname"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:543,columnNumber:25},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:528,columnNumber:23},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:507,columnNumber:21},void 0),!$&&!B&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mb-3",children:e.jsxDEV(Cs,{info:s("phoneNumber.info"),label:p?"payment.etip.mobile_phone_label":"payment.IBANForm.phoneNumber",onlyFrenchMobile:p},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:553,columnNumber:25},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:552,columnNumber:23},void 0),e.jsxDEV("div",{className:"mb-3",children:e.jsxDEV("div",{className:"col-12 col-lg-10 px-0","data-cy":"privacy-policy",children:e.jsxDEV(y.SzTypographie,{variant:"caption",size:"M",weight:"light",children:e.jsxDEV(Bs,{i18nKey:"payment.IBANForm.privacy_policy",components:{redirect:e.jsxDEV(Os,{decorate:!0,to:t,target:"_blank",className:"sz-typo-caption font-family-medium"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:577,columnNumber:35},void 0)}},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:573,columnNumber:29},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:568,columnNumber:27},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:564,columnNumber:25},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:563,columnNumber:23},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:551,columnNumber:21},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:505,columnNumber:17},void 0),E?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(zs,{showOwner:$,holderValue:((ie=h==null?void 0:h.contractData)==null?void 0:ie.ibanHolder)||void 0,ibanValue:((re=o==null?void 0:o.myPmtModeDatas)==null?void 0:re.iban)??((me=h==null?void 0:h.contractData)==null?void 0:me.iban)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:594,columnNumber:21},void 0),e.jsxDEV(y.SzButton,{id:"ibanModify",onClick:bs,variant:"outlined",border:"soft",className:"mt-3",isDisabled:S.isLoading,children:s("payment.IBANForm.ibanModify")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:604,columnNumber:21},void 0),e.jsxDEV("div",{className:"mt-5 border-bottom border-light"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:614,columnNumber:21},void 0),e.jsxDEV(y.SzCheckbox,{name:"checkboxVerified",id:"checkboxVerified",label:s("payment.IBANForm.checkboxValidateData"),type:"checkbox",checked:se.checkboxVerified,onChange:Se,className:"mt-3 mb-2"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:615,columnNumber:21},void 0),e.jsxDEV(xe,{customDisplay:z.checkboxVerified&&O.checkboxVerified,field:"checkboxVerified"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:624,columnNumber:21},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:593,columnNumber:19},void 0):e.jsxDEV(Hs,{isInternational:!p,displayInternationalIban:d,setDisplayInternationalIban:l,disabledInternationalIban:S.isLoading,validationError:(S==null?void 0:S.isError)&&((R=(I=(H=(A=S==null?void 0:S.error)==null?void 0:A.response)==null?void 0:H.data)==null?void 0:I.validation_errors)==null?void 0:R.iban),resetValidationError:()=>S.reset()},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:632,columnNumber:19},void 0),e.jsxDEV(Q,{next:Ns,previous:ys},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:645,columnNumber:17},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:504,columnNumber:15},void 0)}},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:464,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:455,columnNumber:7},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:454,columnNumber:5},void 0):e.jsxDEV(D,{"data-cy":"my-payment-loading",children:e.jsxDEV(rs,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:448,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:447,columnNumber:7},void 0)},ss=()=>{const{state:n}=Z(),{paymentMode:s}=Ne();return(n==null?void 0:n.origin)===_e?e.jsxDEV(cs,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:660,columnNumber:12},void 0):s?e.jsxDEV(ft,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:662,columnNumber:12},void 0):e.jsxDEV(Nt,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/MyPaymentMode.tsx",lineNumber:665,columnNumber:10},void 0)},Te=({isSuccess:n=!0,title:s,subTitle:r,desc:t,descTransError:o,previousButton:u,nextButton:a})=>{const{transform:p}=Re();return e.jsxDEV("div",{children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-3 mb-lg-4",children:s},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:22,columnNumber:7},void 0),e.jsxDEV(y.SzTypographie,{children:r},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:30,columnNumber:7},void 0),n?e.jsxDEV(ae,{className:"mb-5 new-line",children:e.jsxDEV(Me,{content:t,transform:p},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:33,columnNumber:11},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:32,columnNumber:9},void 0):e.jsxDEV(ae,{className:"mb-5 new-line",variant:"alert",children:o||e.jsxDEV(Me,{content:t},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:37,columnNumber:46},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:36,columnNumber:9},void 0),e.jsxDEV(Q,{next:a,previous:u},void 0,!1,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:41,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/Confirmation/index.tsx",lineNumber:21,columnNumber:5},void 0)};function yt(){const n=V();return ue(()=>X.get(F.DOCAPOSTE.DOWNLOAD_MANDATE,{responseType:"blob"}),{onSuccess(s){os.fromFile(s)},onError(){n.push({pathname:m.PAYMENT.ERROR_ETIP})}})}const ts=({isSuccess:n})=>{var B,J,$;const s=V(),r=ne(),{t}=C(),{track:o}=pe(),{paymentMode:u,eFacture:a,isWithMandat:p}=Ne(),d=u==="etip",{payment:l}=g.useContext(Be),c=()=>{s.push(m.DASHBOARD)},{data:i,isLoading:b,isError:P}=je("postPaymentEInvoice",()=>X.post(F.PAYMENT.POST_PAYMENT_E_INVOICE),{enabled:a}),v=((B=i==null?void 0:i.data)==null?void 0:B.message)||"",M=i&&v!==Y.PAYMENT_E_INVOICE_OK,x=t("payment.confirmation.title",{context:d?"etip":""}),f=t("payment.confirmation.einvoice",{context:M||P?"failed":"success"}),w=t("payment.confirmation.etip_message",{context:p?"mandate":"no_mandate"}),E=a?f:d?w:t("payment.confirmation.message"),N=Ee(m.DOWNLOAD_MANDATE_PDF),{isLoading:j,mutate:T}=yt(),h=()=>{p?d?T():window.open(N,"_blank"):s.push(m.DASHBOARD)},k={enabled:p,label:t("managePayments.validate.button_dashboard"),align:"left",onClick:c},U={label:t(p?"managePayments.validate.button_mandate":"managePayments.validate.button_dashboard"),align:"right",onClick:h,loader:j},S=ge("getManagePayment"),W=ge("getIban"),G=!!((J=S.data)!=null&&J.data.content.contractData.iban)||!!(($=W.data)!=null&&$.data.iban);return g.useEffect(()=>{o("PAYMENT_5",{mode_paiement:l!=null&&l.paymentMode?Pe[l.paymentMode]:"",iban_mandat:(G?"avec_iban":"sans_iban")+" "+(p?"avec_mandat":"sans_mandat")})},[]),e.jsxDEV(D,{children:b?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(_,{width:r?256:622,height:46,className:"mb-3"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:122,columnNumber:11},void 0),e.jsxDEV(_,{width:r?256:622,height:150},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:123,columnNumber:11},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:121,columnNumber:9},void 0):e.jsxDEV(e.Fragment,{children:e.jsxDEV(Te,{isSuccess:n,title:x,desc:E,previousButton:k,nextButton:U},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:127,columnNumber:11},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:126,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ConfirmationMandat.tsx",lineNumber:119,columnNumber:5},void 0)},bt=()=>{const n=V(),{t:s}=C(),[r,t]=g.useState(!1),o=()=>{window.location.href=m.CUSTOMER_SERVICE},u=()=>{t(!0),n.push(m.DASHBOARD)},a={enabled:!0,label:s("payment.error.back_customer_service"),align:"left",alignIcon:"right",onClick:o},p={enabled:!0,label:s("payment.error.back_dashboard"),align:"right",loader:r,onClick:u};return e.jsxDEV(D,{"data-cy":"my-payment-error",children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-3 mb-lg-4",children:s("payment.error.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/Error.tsx",lineNumber:42,columnNumber:7},void 0),e.jsxDEV(ae,{children:s("payment.error.message"),variant:"alert"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/Error.tsx",lineNumber:50,columnNumber:7},void 0),e.jsxDEV(Q,{next:p,previous:a},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/Error.tsx",lineNumber:51,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/Error.tsx",lineNumber:41,columnNumber:5},void 0)},wt=(n={})=>{const{previousButton:s,nextButton:r}=n,t=V(),{t:o}=C(),u=()=>{t.push(m.DASHBOARD)},a=()=>{const l=m.PAYMENT_INDEX;t.push(l)},p={label:o("managePayments.validate.button_dashboard"),align:"left",onClick:u,enabled:!0,...s},d={label:o("managePayments.validate.button_reset_payment"),align:"right",onClick:a,...r};return{previousBtn:p,nextBtn:d}},xt=()=>{const{previousBtn:n,nextBtn:s}=wt(),r=ne(),{transform:t}=Re(),{t:o}=C(),{modeListPaymentData:u,isLoading:a}=fe(),p=(u==null?void 0:u.balanceAmount)||"",d=e.jsxDEV(Me,{transform:t,content:o("payment.confirmation_cb.message_error")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:23,columnNumber:5},void 0);if(a)return e.jsxDEV(D,{children:[e.jsxDEV(_,{width:r?256:622,height:46,className:"mb-3"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:29,columnNumber:9},void 0),e.jsxDEV(_,{width:r?256:622,height:150},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:30,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:28,columnNumber:7},void 0);const c=o("payment.confirmation_cb.title",{amount:p,context:p?"error":"error_no_amount"});return e.jsxDEV(D,{children:e.jsxDEV(Te,{isSuccess:!1,title:c,subTitle:o("payment.confirmation_cb.sub_title_error"),descTransError:d,previousButton:n,nextButton:s},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:44,columnNumber:7},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorCB.tsx",lineNumber:43,columnNumber:5},void 0)},ht=()=>{const n=V(),{t:s}=C(),[r,t]=g.useState(!1),o=()=>{t(!0),n.push(m.PAYMENT.INDEX)},u={enabled:!0,label:s("payment.error.back_retry"),align:"right",loader:r,onClick:o};return e.jsxDEV(D,{"data-cy":"my-payment-error",children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-3 mb-lg-4",children:s("payment.error.title_etip")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorEtip.tsx",lineNumber:30,columnNumber:7},void 0),e.jsxDEV(ae,{children:s("payment.error.message_etip"),variant:"alert"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorEtip.tsx",lineNumber:38,columnNumber:7},void 0),e.jsxDEV(Q,{next:u},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorEtip.tsx",lineNumber:39,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/ErrorEtip.tsx",lineNumber:29,columnNumber:5},void 0)},vt=()=>{const{t:n}=C(),[s,r]=g.useState(!1),t=()=>{r(!0),window.location.href=m.CUSTOMER_SERVICE},o={enabled:!0,label:n("payment.error.back_customer_service"),align:"right",loader:s,onClick:t};return e.jsxDEV(D,{children:[e.jsxDEV(y.SzTypographie,{variant:"H3",size:"L",weight:"medium",className:"mb-3 mb-lg-4",children:n("payment.unavailable.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/UnavailablePmtMode.tsx",lineNumber:28,columnNumber:7},void 0),e.jsxDEV(ae,{children:n("payment.unavailable.message"),variant:"alert"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/UnavailablePmtMode.tsx",lineNumber:36,columnNumber:7},void 0),e.jsxDEV(Q,{next:o},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/UnavailablePmtMode.tsx",lineNumber:40,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/UnavailablePmtMode.tsx",lineNumber:27,columnNumber:5},void 0)},as=()=>{const n=V(),{t:s}=C(),r=ne(),{state:t}=Z(),{solde:o}=t||"",u=()=>{n.push(m.DASHBOARD)},{modeListPaymentData:a,isLoading:p}=fe(),d=(a==null?void 0:a.balanceAmount)||"",l=()=>{const f=m.PAYMENT_INDEX;n.push(f)},c={label:s("managePayments.validate.button_dashboard"),align:"left",onClick:u,enabled:!0},i={label:s("managePayments.validate.button_reset_payment"),align:"right",onClick:l},{transform:b}=Re(),P=e.jsxDEV(Me,{transform:b,content:s("payment.confirmation_cb.message_cancel")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:49,columnNumber:5},void 0),v=o||d,x=s("payment.confirmation_cb.title_cancel",{amount:v,context:v?"cancel":"cancel_no_amount"});return p?e.jsxDEV(D,{children:[e.jsxDEV(_,{width:r?256:622,height:46,className:"mb-3"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:67,columnNumber:9},void 0),e.jsxDEV(_,{width:r?256:622,height:150},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:68,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:66,columnNumber:7},void 0):e.jsxDEV(D,{children:e.jsxDEV(Te,{isSuccess:!1,title:x,desc:s("payment.confirmation_cb.message_cancel"),descTransError:P,previousButton:c,nextButton:i},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:75,columnNumber:7},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/CancelCB.tsx",lineNumber:74,columnNumber:5},void 0)},Et=()=>{const n=V(),{t:s}=C(),r=ne(),{state:t}=Z(),{solde:o}=t||"",u=()=>{n.push(m.DASHBOARD)},{modeListPaymentData:a,isLoading:p}=fe(),d=(a==null?void 0:a.balanceAmount)||"",l=()=>{window.open(F.PAYMENT.DOWNLOAD_TICKET,"_blank")},c={label:s("managePayments.validate.button_dashboard"),align:"left",onClick:u,enabled:!0},i={label:s("managePayments.validate.button_download_ticket_payline"),align:"right",onClick:l},b=o||d,v=s("payment.confirmation_cb.title",{amount:b,context:b?"success":"success_no_amount"});return p?e.jsxDEV(D,{children:[e.jsxDEV(_,{width:r?256:622,height:46,className:"mb-3"},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SuccessCB.tsx",lineNumber:56,columnNumber:9},void 0),e.jsxDEV(_,{width:r?256:622,height:150},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SuccessCB.tsx",lineNumber:57,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SuccessCB.tsx",lineNumber:55,columnNumber:7},void 0):e.jsxDEV(D,{children:e.jsxDEV(Te,{isSuccess:!0,title:v,desc:s("payment.confirmation_cb.message_success"),previousButton:c,nextButton:i},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SuccessCB.tsx",lineNumber:64,columnNumber:7},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/steps/SuccessCB.tsx",lineNumber:63,columnNumber:5},void 0)};function ds(){return[{step:bt,path:m.PAYMENT.ERROR},{step:ht,path:m.PAYMENT.ERROR_ETIP},{step:Et,path:m.PAYMENT.CONFIRMATION_CB,isSuccess:!0},{step:xt,path:m.PAYMENT.CONFIRMATION_CB_FAILED,isSuccess:!1},{step:as,path:m.PAYMENT.CANCEL_CB,isSuccess:!1},{step:ts,path:m.PAYMENT.CONFIRMATION,isSuccess:!0,hasSummaryBox:!0,isOpen:!1},{step:ts,path:m.PAYMENT.CONFIRMATION_WITHOUT_MANDAT,hasSummaryBox:!0,isSuccess:!1,isOpen:!1},{step:ss,path:m.PAYMENT.ETIP,hasSummaryBox:!0,isOpen:!0},{step:as,path:m.PAYMENT.CANCEL_CB,isSuccess:!1},{step:cs,path:m.PAYMENT.SIGN_MANDAT,hasSummaryBox:!0,isOpen:!1},{step:vt,path:m.PAYMENT.UNAVAILABLE_PMT_MODE},{step:mt,path:m.PAYMENT_INDEX},{step:ss,path:m.PAYMENT.MY_PAYMENT_METHOD}]}function gt(){const n=ds();return e.jsxDEV(Ts,{children:n.map(s=>{const{path:r,...t}=s,o=s.step;return e.jsxDEV(As,{path:r,children:e.jsxDEV(o,{...t},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentStepper.tsx",lineNumber:17,columnNumber:13},this)},Array.isArray(r)?r[0]:r,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentStepper.tsx",lineNumber:16,columnNumber:11},this)})},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/PaymentStepper.tsx",lineNumber:10,columnNumber:5},this)}const Ae=te.createContext(null);function Mt(){const{t:n}=C(),s=ne(),[r,t]=g.useState(),{state:o,search:u,pathname:a}=Z(),d=ds().find(b=>Array.isArray(b.path)?b.path[0]===a:b.path===a),l=new URLSearchParams(u),c=(d==null?void 0:d.hasSummaryBox)??(a===m.PAYMENT.MY_PAYMENT_METHOD&&l.has("payment_mode")),i=(d==null?void 0:d.isOpen)??(a===m.PAYMENT.MY_PAYMENT_METHOD&&l.has("payment_mode")&&(o==null?void 0:o.origin)!==_e);return e.jsxDEV(Ae.Provider,{value:{managePayment:r,setManagePayment:t},children:e.jsxDEV(vs,{id:"payment-manage-v3",type:"payment",children:[e.jsxDEV(y.SzTypographie,{variant:"H1",size:s?"L":"XL",align:"center",color:"light",weight:"black",className:"mb-4 text-uppercase",children:n("payment.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/index.tsx",lineNumber:54,columnNumber:9},this),c&&e.jsxDEV(rt,{isOpen:i},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/index.tsx",lineNumber:64,columnNumber:27},this),e.jsxDEV(gt,{},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/index.tsx",lineNumber:65,columnNumber:9},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/pages/payment/index.tsx",lineNumber:53,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/pages/payment/index.tsx",lineNumber:52,columnNumber:5},this)}const ea=Object.freeze(Object.defineProperty({__proto__:null,PaymentContext:Ae,default:Mt},Symbol.toStringTag,{value:"Module"}));export{Ce as M,nt as P,Je as a,ea as i,fe as u};
