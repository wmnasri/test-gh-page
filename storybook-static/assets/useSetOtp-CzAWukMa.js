import{j as e,b as i}from"./index-BzhTyqaY.js";import{t as I,n as k,d as z}from"./react-spring-web.esm-DsMzZgQq.js";import{r as D}from"./index-0X8QCd_i.js";import{L as A,R as c,$ as M,U as B,V as Y}from"./main-BbuvrTKi.js";import"./index-m5SwaE3w.js";import{u as f,a as p,C as x,b as L,g as U,e as W,A as v}from"./AxiosInstance-BZZbXQ8a.js";import{u as g,F as G}from"./formik.esm-DgjVmEdT.js";/* empty css              *//* empty css                         */import{u as w}from"./useMutation-DnofRurj.js";import{u as j}from"./useTranslation-BYGhmYBG.js";import{S as H}from"./Tips-j9k3pi84.js";import{F as K}from"./index-BsXj3zEC.js";import{I as X,a as $}from"./InputSeries-CZppcBLq.js";import{d as q}from"./index-D1YCTWBN.js";import{F as J}from"./FormError-BtpZASc0.js";function Q({url:a,pathname:n,search:t,isBlob:o,onSuccess:r}){const m=f();return w(()=>p.get(a,o?{responseType:"blob"}:void 0),{onSuccess:r||(({data:u})=>{const{code:l,content:d}=u;if(x.SUCCESS===l){const{rawData:b,filename:h}=d;I.fromBase64(b,h,A)}else m.push({pathname:n,search:t})}),onError(){m.push({pathname:n,search:t})}})}function xe({url:a,pathname:n,search:t,mobilePhone:o,isBlob:r,onSuccess:m}){const{t:s}=j(),{isLoading:u,mutate:l}=Q({url:a,pathname:n,search:t,isBlob:r,onSuccess:m}),d=()=>{l()};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(i.SzTypographie,{variant:"H3",size:"L",tag:"h2",weight:"medium",className:"sign-mandate-title",children:s("payment.sign_mandate.title")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:31,columnNumber:7},this),e.jsxDEV(i.SzTypographie,{className:"sign-mandate-infos",children:s("payment.sign_mandate.infos",{mobilePhone:o})},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:41,columnNumber:7},this),e.jsxDEV(i.SzButton,{id:"downloadMandate",icon:"download-bottom",variant:"text",className:"px-0",onClick:d,loader:u,children:s("payment.sign_mandate.btn_download")},void 0,!1,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:44,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/components/DownloadMandate.tsx",lineNumber:30,columnNumber:5},this)}function Z(){const a=f(),{search:n,pathname:t}=L(),o=new URLSearchParams(n),r=t.includes(c.PAYMENT.ETIP),m=r?M:o.get("payment_mode"),s=o.get("e-facture")==="true",u=o.get("mandat")==="true";return D.useEffect(()=>{m&&![B,Y,M].includes(m)&&a.push(U(c.PAYMENT_INDEX))},[]),{paymentMode:m,eFacture:s,isWithMandat:u,isRouteEtip:r}}function ee({defaultLabelSize:a=!1,...n}){const{name:t}=n,{setFieldValue:o,values:r,errors:m}=g(),s=({target:u})=>{const{checked:l}=u;o(t,l)};return e.jsxDEV(e.Fragment,{children:[e.jsxDEV(i.SzCheckbox,{...n,checked:r[t],onChange:s,className:a?"":"small"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:21,columnNumber:7},this),e.jsxDEV(J,{field:t,customDisplay:m[t]},void 0,!1,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:27,columnNumber:7},this)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/InputCheckbox.tsx",lineNumber:20,columnNumber:5},this)}function se(a){const n=f(),{resetForm:t}=g(),o=W(c.SUBSCRIBE_FULL),r=o?v.MOVE_IN.NEW_OTP:v.PAYMENT.GET_PAYMENT_NEW_OPT,m=o?c.MOVE_IN.ERROR_URL:c.PAYMENT.ERROR;return w(()=>p.get(r.concat("?mobilePhone=",encodeURIComponent(a))),{onSuccess:({data:s})=>{(s==null?void 0:s.message)===x.OK?t():n.push(m)}})}function ae(){const a=f();return w(n=>p.post(v.DOCAPOSTE.SEND_OTP,n),{onError(){a.push({pathname:c.PAYMENT.ERROR_ETIP})}})}const ne=k(i.SzIcon)`
  color: var(--gray);
  font-size: 1.125rem;
`,_="input",N="opt-in";function ge({onSubmit:a,...n}){const{t}=j(),o={input:"",[N]:!1},r=X({name:_}).shape({[N]:q(t("payment.sign_mandate.form.validation_error"))});return e.jsxDEV(G,{initialValues:o,validationSchema:r,onSubmit:a,enableReinitialize:!0,validateOnChange:!1,validateOnBlur:!0,children:e.jsxDEV(te,{...n},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:58,columnNumber:7},this)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:50,columnNumber:5},this)}const te=({errorReset:a,setErrorReset:n,onPrevClick:t,label:o,loadingSubmit:r,mobilePhone:m})=>{const{t:s}=j(),{track:u}=z(),{isRouteEtip:l}=Z(),d=f(),{handleSubmit:b,resetForm:h}=g();D.useEffect(()=>{a&&u("PAYMENT_7")},[a]);const S={prefixName:_,length:6,label:s("payment.sign_mandate.form.code_label")},y={label:s("go_back"),arrow:"true",enabled:!0,onClick:t},F={label:o||s("payment.sign_mandate.form.btn_submit"),align:"right",loader:r},{isLoading:T,...V}=se(m),{isLoading:O,...P}=ae(),R={sendBack:"true"},C=()=>{l?P.mutate(R,{onSuccess:({data:E})=>{(E==null?void 0:E.message)===x.OK?(h(),n(!1)):d.push(c.PAYMENT.ERROR_ETIP)}}):V.mutate()};return e.jsxDEV("form",{"data-cy":"mandate-form",onSubmit:b,className:"digit-form pt-3 row w-100 m-0 no-gutters",children:[e.jsxDEV($,{...S,children:e.jsxDEV(i.SzButton,{onClick:C,className:"cy-btn-reset-index ml-0 ml-sm-4 pl-0",variant:"text",icon:"synchronize-arrow-1",loader:T||O,children:s("payment.sign_mandate.form.btn_retry")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:130,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:129,columnNumber:7},void 0),a&&e.jsxDEV(i.SzTypographie,{tag:"div",variant:"caption",color:"danger",className:"w-100",children:s("payment.sign_mandate.error_otp")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:141,columnNumber:9},void 0),e.jsxDEV(H,{horizontal:!0,className:"my-2 my-lg-4 bg-gray-0"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:151,columnNumber:7},void 0),e.jsxDEV("div",{className:"d-flex align-items-center",children:[e.jsxDEV(ne,{icon:"information-circle",variant:"line"},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:153,columnNumber:9},void 0),e.jsxDEV(i.SzTypographie,{tag:"div",variant:"caption",size:"M",className:"ml-2",children:[e.jsxDEV(i.SzTypographie,{className:"mb-0",children:s("payment.sign_mandate.help")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:155,columnNumber:11},void 0),e.jsxDEV("ul",{className:"mb-0 pl-3 ml-2",children:[e.jsxDEV(i.SzTypographie,{tag:"li",children:s("payment.sign_mandate.help_1")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:159,columnNumber:13},void 0),e.jsxDEV(i.SzTypographie,{tag:"li",children:s("payment.sign_mandate.help_2")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:163,columnNumber:13},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:158,columnNumber:11},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:154,columnNumber:9},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:152,columnNumber:7},void 0),e.jsxDEV("div",{className:"col-12 mt-4 mt-lg-5 mb-3",children:e.jsxDEV(ee,{id:N,name:N,label:s("payment.sign_mandate.form.validation_label")},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:170,columnNumber:9},void 0)},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:169,columnNumber:7},void 0),e.jsxDEV(K,{previous:y,next:F},void 0,!1,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:176,columnNumber:7},void 0)]},void 0,!0,{fileName:"/usr/var/www/assets/js/form/MandateForm.tsx",lineNumber:124,columnNumber:5},void 0)};function je({url:a,onSuccess:n,onError:t}){return w(o=>p.post(a,o),{onSuccess:n,onError:t})}export{xe as D,ge as M,je as a,ae as b,Z as u};
